# Project Directory Structure

```text
.personal_vlog/
    .gitignore
    developing.py
    directory_template.html
    git_batch_push.sh
    main.py
    README.md
    data/
        index.html
        messages.json
        sessions.json
        users.json
        visit_count.json
    home/
        index.html
        img/
    login/
        index.html
        register.html
    logs/
        access_20260213.log
        access_20260214.log
        flask_message_board.log
        server.log
    src/
        auth.py
        message_board.py
        qqmail.py
        test_email.py
        visit_counter.py
    static/
        js/
            auth-interceptor.js
            auth.js
    talk/
        comment.html
```

---

## File: README.md

```md
# ä¸ªäººåšå®¢/æ—¥å¿—é¡¹ç›® (personal_vlog)
è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªä¸ªäººåŒ–çš„æ—¥å¿—/åšå®¢ç±»ç½‘ç«™ï¼Œç”¨äºè®°å½•ä¸ªäººçš„å¼€å‘é¡¹ç›®ã€DIYåˆ¶ä½œã€æ—…è¡Œç»å†ã€ç”Ÿæ´»ç‚¹æ»´ç­‰å†…å®¹ï¼Œé€šè¿‡ç»“æ„åŒ–çš„ç›®å½•å’Œé¡µé¢å±•ç¤ºå„ç±»å›¾æ–‡ã€è§†é¢‘ç´ æã€‚

## é¡¹ç›®ç›®å½•ç»“æ„
```
.personal_vlog/
    â”œâ”€â”€ directory_template.html  # ç›®å½•æ¨¡æ¿HTMLæ–‡ä»¶
    â”œâ”€â”€ git_batch_push.sh        # Gitæ‰¹é‡æ¨é€è„šæœ¬
    â”œâ”€â”€ main.py                  # é¡¹ç›®ä¸»ç¨‹åº
    â”œâ”€â”€ message_board.py         # ç•™è¨€æ¿åŠŸèƒ½æ¨¡å—
    â”œâ”€â”€ qqmail.py                # QQé‚®ä»¶ç›¸å…³åŠŸèƒ½æ¨¡å—
    â”œâ”€â”€ data/
    â”‚   â””â”€â”€ messages.json        # ç•™è¨€æ¿æ•°æ®å­˜å‚¨æ–‡ä»¶
    â”œâ”€â”€ home/
    â”‚   â”œâ”€â”€ index.html           # ç½‘ç«™é¦–é¡µ
    â”‚   â””â”€â”€ img/
    â”‚       â””â”€â”€ bg.jpg           # é¦–é¡µèƒŒæ™¯å›¾ç‰‡
    â”œâ”€â”€ pages/
    â”‚   â”œâ”€â”€ devlog/              # å¼€å‘æ—¥å¿—æ¿å—
    â”‚   â”‚   â”œâ”€â”€ CQU-coursehelper/  # é‡åº†å¤§å­¦è¯¾ç¨‹åŠ©æ‰‹é¡¹ç›®
    â”‚   â”‚   â”œâ”€â”€ CQU-CRTCæœºå™¨äººæ¯”èµ›/ # CRTCæœºå™¨äººæ¯”èµ›ç›¸å…³è®°å½•ï¼ˆå«å„ç‰ˆæœ¬è½¦è¾†æµ‹è¯•è§†é¢‘/å›¾ç‰‡ï¼‰
    â”‚   â”‚   â”œâ”€â”€ Gsing/           # Gsingé¡¹ç›®ï¼ˆæœºæ¢°è‡‚ã€YOLOã€OLEDã€ç®—é¢˜è¯†åˆ«ç­‰ï¼‰
    â”‚   â”‚   â”œâ”€â”€ personal-blog/   # ä¸ªäººåšå®¢å¼€å‘å†ç¨‹ï¼ˆå„ç‰ˆæœ¬ç½‘ç«™æˆªå›¾ã€ç•™è¨€æ¿æˆªå›¾ï¼‰
    â”‚   â”‚   â””â”€â”€ å£°æ§å¼€å…³ç¯/      # å£°æ§å¼€å…³ç¯é¡¹ç›®ï¼ˆå«æ¼”ç¤ºè§†é¢‘ï¼‰
    â”‚   â”œâ”€â”€ diy/                 # DIYæ¿å—ï¼ˆç¡¬ä»¶/è®¾å¤‡æ”¹é€ ç›¸å…³ï¼‰
    â”‚   â”‚   â””â”€â”€ å„ç±»ç¡¬ä»¶é‡‡è´­/æ”¹é€ å›¾ç‰‡ï¼ˆæ˜¾å¡ã€CPUã€ä¸»æœºæ”¹é€ ç­‰ï¼‰
    â”‚   â”œâ”€â”€ travel/              # æ—…è¡Œæ¿å—
    â”‚   â”‚   â”œâ”€â”€ 2024.7.28-ä¸Šæµ·æ—…æ¸¸-3days/ # ä¸Šæµ·æ—…æ¸¸è®°å½•
    â”‚   â”‚   â”œâ”€â”€ 2025.6.14-æ­å·æ”¯æŒæµ™æ±Ÿé˜Ÿ/ # æ­å·è§‚èµ›è®°å½•
    â”‚   â”‚   â”œâ”€â”€ 2025.6.15-å—äº¬å¤§å­¦å¼ºåŸºè®°-2days/ # å—äº¬å¤§å­¦å¼ºåŸºè®¡åˆ’ç›¸å…³
    â”‚   â”‚   â”œâ”€â”€ 2025.6.16-ä¸Šæµ·äº¤é€šå¤§å­¦é¢è¯•è®°-3days/ # ä¸Šäº¤é¢è¯•è®°å½•
    â”‚   â”‚   â”œâ”€â”€ 2025.7.24-ç™¾ä¸ˆæ¼ˆ/ # ç™¾ä¸ˆæ¼ˆæ—…è¡Œè®°å½•
    â”‚   â”‚   â””â”€â”€ 2025.8.17-é›è¡å±±/ # é›è¡å±±æ—…è¡Œè®°å½•
    â”‚   â”œâ”€â”€ video/               # è§†é¢‘ç´ ææ±‡æ€»
    â”‚   â”‚   â”œâ”€â”€ æ¸©å·å¤§é›ª.mp4
    â”‚   â”‚   â””â”€â”€ èšæ˜¯ä¸€å›¢ç«ï¼Œæ•£æ˜¯æ»¡å¤©æ˜Ÿ.mp4
    â”‚   â””â”€â”€ YYå¾€äº‹/              # ç”Ÿæ´»ç‚¹æ»´/å¾€äº‹è®°å½•
    â”‚       â””â”€â”€ .DCIM/           # å¤§é‡ç”Ÿæ´»ç…§ç‰‡ã€è§†é¢‘ç´ æ
```

## åŠŸèƒ½è¯´æ˜
1. **æ ¸å¿ƒæ¨¡å—**
   - `main.py`ï¼šé¡¹ç›®å…¥å£ï¼Œè´Ÿè´£ç½‘ç«™æ ¸å¿ƒé€»è¾‘è¿è¡Œ
   - `message_board.py`ï¼šç®€æ˜“ç•™è¨€æ¿åŠŸèƒ½ï¼Œæ•°æ®å­˜å‚¨åœ¨`data/messages.json`
   - `git_batch_push.sh`ï¼šæ‰¹é‡æ¨é€ä»£ç /ç´ æåˆ°Gitä»“åº“çš„è„šæœ¬ï¼Œç®€åŒ–ç‰ˆæœ¬ç®¡ç†

2. **å†…å®¹æ¿å—**
   - **å¼€å‘æ—¥å¿— (devlog)**ï¼šè®°å½•å„ç±»æŠ€æœ¯é¡¹ç›®çš„å¼€å‘è¿‡ç¨‹ã€æµ‹è¯•ç´ æï¼ˆæœºå™¨äººæ¯”èµ›ã€æœºæ¢°è‡‚ã€YOLOè§†è§‰ã€å£°æ§è®¾å¤‡ç­‰ï¼‰
   - **DIYä¸“åŒº**ï¼šè®°å½•ç¡¬ä»¶é‡‡è´­ã€ä¸»æœºæ”¹é€ ã€é…ä»¶è°ƒè¯•ç­‰DIYè¿‡ç¨‹åŠç´ æ
   - **æ—…è¡Œè®°å½•**ï¼šæŒ‰æ—¶é—´/åœ°ç‚¹åˆ†ç±»çš„æ—…è¡Œå›¾æ–‡ã€è§†é¢‘ç´ æï¼Œæ¶µç›–ä¸Šæµ·ã€æ­å·ã€å—äº¬ã€æ¸©å·ç­‰åœ°
   - **ç”Ÿæ´»ç‚¹æ»´**ï¼šå­˜å‚¨ä¸ªäººç”Ÿæ´»ç›¸å…³çš„ç…§ç‰‡ã€è§†é¢‘ç´ æ

## éƒ¨ç½²/ä½¿ç”¨è¯´æ˜
1. å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°åï¼Œå¯ç›´æ¥æ‰“å¼€`home/index.html`è®¿é—®ç½‘ç«™é¦–é¡µ
2. ç•™è¨€æ¿åŠŸèƒ½ä¾èµ–`message_board.py`å’Œ`data/messages.json`ï¼Œéœ€è¿è¡ŒPythonç¯å¢ƒ
3. è‹¥éœ€æ¨é€æ›´æ–°åˆ°Gitä»“åº“ï¼Œå¯æ‰§è¡Œ`git_batch_push.sh`è„šæœ¬ï¼ˆéœ€é…ç½®Gitç¯å¢ƒï¼‰
4. å„å­é¡µé¢ï¼ˆå¦‚æ—…è¡Œã€å¼€å‘æ—¥å¿—ï¼‰å¯é€šè¿‡å¯¹åº”ç›®å½•ä¸‹çš„`index.html`è®¿é—®

## ç´ æè¯´æ˜
- å›¾ç‰‡æ ¼å¼ï¼šjpgã€pngã€JPGç­‰
- è§†é¢‘æ ¼å¼ï¼šmp4ã€aviã€movã€MOVç­‰
- æ‰€æœ‰ç´ ææŒ‰ä¸šåŠ¡åœºæ™¯åˆ†ç±»å­˜å‚¨åœ¨å¯¹åº”ç›®å½•ï¼Œä¾¿äºç®¡ç†å’Œè®¿é—®

## æ³¨æ„äº‹é¡¹
1. éƒ¨åˆ†è§†é¢‘/å›¾ç‰‡ç´ æä¸ºä¸ªäººéšç§å†…å®¹ï¼Œè¯·å‹¿éšæ„ä¼ æ’­
2. è¿è¡ŒPythonç›¸å…³æ¨¡å—æ—¶ï¼Œéœ€ç¡®ä¿å®‰è£…å¯¹åº”ä¾èµ–ï¼ˆå¦‚é‚®ä»¶æ¨¡å—ã€JSONå¤„ç†ç­‰ï¼‰
3. è„šæœ¬æ–‡ä»¶ï¼ˆå¦‚git_batch_push.shï¼‰éœ€èµ‹äºˆæ‰§è¡Œæƒé™åè¿è¡Œï¼ˆLinux/Macï¼š`chmod +x git_batch_push.sh`ï¼‰

```

---

## File: data\index.html

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç¦æ­¢è®¿é—® - hyperçš„ä¸ªäººVlog</title>
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            font-family: 'Microsoft YaHei', sans-serif;
            text-align: center;
            padding: 100px 20px;
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            max-width: 600px;
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            color: #6a5acd;
            font-size: 3rem;
            margin-bottom: 20px;
        }
        .icon {
            font-size: 5rem;
            color: #ff6b6b;
            margin-bottom: 20px;
        }
        p {
            color: #495057;
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 30px;
        }
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: #6a5acd;
            color: white;
            text-decoration: none;
            border-radius: 30px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: #ff6b6b;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(106, 90, 205, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="icon">ğŸ”’</div>
        <h1>403 Forbidden</h1>
        <p>ä½ æ²¡æœ‰æƒé™è®¿é—®æ­¤ç›®å½•<br>è¯·è¿”å›é¦–é¡µç»§ç»­æµè§ˆ</p>
        <a href="/home/index.html" class="btn">è¿”å›é¦–é¡µ</a>
    </div>
</body>
</html>
```

---

## File: developing.py

```py
# -*- coding: utf-8 -*-
"""
ä¸ªäººåšå®¢å‡çº§ç»´æŠ¤ä¸´æ—¶æœåŠ¡ï¼ˆç§»é™¤é¢„è®¡æ¢å¤æ—¶é—´ç‰ˆï¼‰
æ›¿æ¢ main.py å³å¯å¯åŠ¨ï¼Œæ— éœ€ä¾èµ–å…¶ä»–æ¨¡å—
"""
import os
import logging
import socket
from http.server import BaseHTTPRequestHandler, ThreadingHTTPServer

# ===================== åŸºç¡€é…ç½®ï¼ˆå’ŒåŸé¡¹ç›®ä¿æŒä¸€è‡´ï¼‰ =====================
HOST = "0.0.0.0"
PORT = 8000
# å‡çº§æç¤ºé…ç½®ï¼ˆç§»é™¤é¢„è®¡æ¢å¤æ—¶é—´ï¼‰
MAINTENANCE_TITLE = "ä¸ªäººåšå®¢å‡çº§ä¸­ ğŸš§"
MAINTENANCE_MSG = "ç½‘ç«™æ­£åœ¨è¿›è¡Œå†…å®¹ä¼˜åŒ–å’ŒåŠŸèƒ½å‡çº§ï¼Œæš‚æ— æ³•è®¿é—®"
CONTACT_INFO = "å¦‚æœ‰ç´§æ€¥é—®é¢˜ï¼Œå¯é€šè¿‡é‚®ç®± 2361542526@qq.com è”ç³»"

# ===================== æ—¥å¿—åˆå§‹åŒ–ï¼ˆæç®€ç‰ˆï¼‰ =====================
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s - %(levelname)s - %(message)s",
    datefmt="%Y-%m-%d %H:%M:%S"
)
logger = logging.getLogger(__name__)

# ===================== å‡çº§é¡µé¢å¤„ç†å™¨ =====================
class MaintenanceHandler(BaseHTTPRequestHandler):
    # è¦†ç›–æ—¥å¿—è¾“å‡ºï¼Œå’ŒåŸé¡¹ç›®æ ¼å¼å¯¹é½
    def log_message(self, format, *args):
        client_ip = self.address_string()
        logger.info(f"[{client_ip}] {format % args}")

    # ç”Ÿæˆå‡çº§æç¤ºé¡µé¢ï¼ˆç§»é™¤æ¢å¤æ—¶é—´ç›¸å…³å†…å®¹ï¼‰
    def _get_maintenance_html(self):
        html = f"""
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{MAINTENANCE_TITLE}</title>
    <style>
        * {{ margin: 0; padding: 0; box-sizing: border-box; font-family: Microsoft YaHei; }}
        body {{ 
            background: #f8f9fa; 
            padding: 40px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh;
        }}
        .container {{ 
            max-width: 800px; 
            background: white; 
            padding: 50px; 
            border-radius: 12px; 
            box-shadow: 0 2px 20px rgba(0,0,0,0.1); 
            text-align: center;
        }}
        h1 {{ 
            color: #6a5acd; 
            font-size: 2.5em; 
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }}
        h1 i {{ font-size: 1.2em; }}
        .msg {{ 
            color: #495057; 
            font-size: 1.2em; 
            line-height: 1.8; 
            margin: 30px 0;
        }}
        .contact {{ 
            color: #6c757d; 
            margin-top: 30px; 
            font-size: 1em;
        }}
        /* é€‚é…åŸé¡¹ç›®çš„å›¾æ ‡é£æ ¼ */
        @import url("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css");
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-tools"></i> {MAINTENANCE_TITLE}</h1>
        <div class="msg">{MAINTENANCE_MSG}</div>
        <div class="contact">ğŸ“§ {CONTACT_INFO}</div>
    </div>
</body>
</html>
        """
        return html

    # å¤„ç†æ‰€æœ‰GETè¯·æ±‚
    def do_GET(self):
        self.send_response(200)
        self.send_header("Content-type", "text/html; charset=utf-8")
        self.end_headers()
        # è¿”å›å‡çº§æç¤ºé¡µé¢
        self.wfile.write(self._get_maintenance_html().encode('utf-8'))

    # å¤„ç†POSTè¯·æ±‚ï¼ˆå…¼å®¹ç•™è¨€æ¿ç­‰POSTåœºæ™¯ï¼‰
    def do_POST(self):
        self.send_response(200)
        self.send_header("Content-type", "text/html; charset=utf-8")
        self.end_headers()
        # åŒæ ·è¿”å›å‡çº§æç¤º
        self.wfile.write(self._get_maintenance_html().encode('utf-8'))

# ===================== å¯åŠ¨æœåŠ¡å™¨ =====================
def run_maintenance_server():
    # ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨ï¼ˆå’ŒåŸé¡¹ç›®å¯¹é½ï¼‰
    log_dir = os.path.join(os.path.dirname(os.path.abspath(__file__)), "logs")
    os.makedirs(log_dir, exist_ok=True)

    # åˆ›å»ºæœåŠ¡å™¨
    try:
        server = ThreadingHTTPServer((HOST, PORT), MaintenanceHandler)
        # ç«¯å£å¤ç”¨ï¼Œé¿å…é‡å¯æŠ¥é”™
        server.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        
        # è¾“å‡ºå¯åŠ¨ä¿¡æ¯ï¼ˆå’ŒåŸé¡¹ç›®æ ¼å¼ä¸€è‡´ï¼‰
        local_ip = socket.gethostbyname(socket.gethostname())
        logger.info("\nğŸš§ ä¸ªäººåšå®¢å‡çº§ç»´æŠ¤æœåŠ¡å·²å¯åŠ¨ï¼")
        logger.info(f"â”œâ”€ æœ¬åœ°è®¿é—®: http://localhost:{PORT}")
        logger.info(f"â”œâ”€ å¤–ç½‘è®¿é—®: http://{local_ip}:{PORT}")
        logger.info(f"â””â”€ ç»´æŠ¤æç¤ºï¼š{MAINTENANCE_MSG}")
        
        # æŒç»­è¿è¡Œ
        server.serve_forever()
    except KeyboardInterrupt:
        logger.info("\nğŸ›‘ ç»´æŠ¤æœåŠ¡å·²åœæ­¢")
        server.server_close()
    except Exception as e:
        logger.error(f"æœåŠ¡å¯åŠ¨å¤±è´¥ï¼š{e}")
        exit(1)

if __name__ == "__main__":
    run_maintenance_server()
```

---

## File: directory_template.html

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    <style>
        :root {{
            --primary: #6a5acd;
            --accent: #ff6b6b;
            --light: #f8f9fa;
            --dark: #2d3436;
            --gray: #495057;
            --light-gray: #e9ecef;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }}
        
        * {{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }}
        
        body {{
            background-color: var(--light);
            color: var(--gray);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }}
        
        header {{
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }}
        
        .breadcrumb {{
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }}
        
        .breadcrumb a {{
            color: var(--primary);
            text-decoration: none;
        }}
        
        .breadcrumb a:hover {{
            color: var(--accent);
            text-decoration: underline;
        }}
        
        .breadcrumb span {{
            color: var(--gray);
        }}
        
        h1 {{
            color: var(--dark);
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }}
        
        h1 i {{
            color: var(--primary);
        }}
        
        .directory-grid {{
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }}
        
        @media (max-width: 768px) {{
            .directory-grid {{
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }}
        }}
        
        @media (max-width: 480px) {{
            .directory-grid {{
                grid-template-columns: 1fr;
            }}
        }}
        
        .item {{
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }}
        
        .item:hover {{
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            border-color: var(--primary);
        }}
        
        .item.folder {{
            border: 2px solid var(--primary);
        }}
        
        .item.file {{
            border: 2px solid var(--light-gray);
        }}
        
        .item i {{
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }}
        
        .item.folder i {{
            color: var(--accent);
        }}
        
        .item-name {{
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 100%;
        }}
        
        .back-btn {{
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: all 0.2s ease;
        }}
        
        .back-btn:hover {{
            background: var(--accent);
            transform: translateX(-3px);
        }}
        
        footer {{
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid var(--light-gray);
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
        }}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="breadcrumb">
            {breadcrumb}
        </div>
        <h1>
            <i class="fas fa-folder-open"></i>
            ç›®å½•åˆ—è¡¨: {path}
        </h1>
    </header>
    
    <main>
        {back_button}
        <div class="directory-grid">
            {items}
        </div>
    </main>
    
    <footer>
        <p>hyperçš„ä¸ªäººVlog | ç›®å½•æµè§ˆ</p>
    </footer>
</body>
</html>
```

---

## File: home\index.html

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hyperçš„ä¸ªäººVlog | è®°å½•ç”Ÿæ´»ï¼Œåˆ†äº«æ•…äº‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --color-primary: #6a5acd;
            --color-accent: #ff6b6b;
            --color-secondary: #4ecdc4;
            --color-dark: #2d3436;
            --color-light: #f8f9fa;
            --color-white: #ffffff;
            --color-gray: #495057;
            --color-light-gray: #e9ecef;
            --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.12);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --transition-base: all 0.3s ease;
            --transition-fast: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: var(--color-light);
            color: var(--color-gray);
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        .container {
            width: min(1200px, 90%);
            margin: 0 auto;
            padding: 0 15px;
        }

        /* è®¿é—®è®¡æ•°æ ·å¼ */
        .visit-counter-box {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(106, 90, 205, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            box-shadow: var(--shadow-md);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition-fast);
        }
        
        .visit-counter-box:hover {
            background: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .visit-counter-number {
            font-weight: bold;
            color: #fff;
        }

        /* å¤´éƒ¨å¯¼èˆª */
        header {
            background-color: var(--color-white);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition-base);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i {
            color: var(--color-accent);
            font-size: 1.5rem;
        }

        .logo span {
            color: var(--color-accent);
        }

        .nav-links {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-links li {
            margin-left: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--color-gray);
            font-weight: 500;
            transition: var(--transition-fast);
            position: relative;
            padding: 8px 0;
        }

        .nav-links a:hover {
            color: var(--color-accent);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--color-accent);
            transition: var(--transition-base);
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        /* ç”¨æˆ·çŠ¶æ€æ ·å¼ */
        .user-status {
            margin-left: 20px;
            position: relative;
        }

        .user-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            transition: var(--transition-fast);
        }

        .user-btn:hover {
            background: var(--color-accent);
            transform: translateY(-2px);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-md);
            min-width: 120px;
            display: none;
            z-index: 1000;
            margin-top: 5px;
            overflow: hidden;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            color: var(--color-gray);
            text-decoration: none;
            transition: var(--transition-fast);
            border-bottom: 1px solid var(--color-light-gray);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--color-light);
            color: var(--color-primary);
        }

        .mobile-menu-btn {
            display: none;
            font-size: 1.5rem;
            color: var(--color-primary);
            cursor: pointer;
            border: none;
            background: none;
        }

        /* è‹±é›„åŒº */
        .hero {
            background: linear-gradient(rgba(106, 90, 205, 0.85), rgba(255, 107, 107, 0.85)), url('img/bg.png');
            background-size: cover;
            background-position: center;
            color: var(--color-white);
            text-align: center;
            padding: 120px 0;
            margin-bottom: 80px;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: clamp(1.8rem, 5vw, 3.5rem);
            margin-bottom: 20px;
        }

        .hero p {
            font-size: clamp(1rem, 2vw, 1.2rem);
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .hero-btn {
            display: inline-block;
            background-color: var(--color-white);
            color: var(--color-primary);
            padding: 12px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition-base);
            box-shadow: var(--shadow-md);
        }

        .hero-btn:hover {
            background-color: var(--color-secondary);
            color: var(--color-white);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        /* é€šç”¨åŒºå—æ ‡é¢˜ */
        .section-title {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        .section-title h2 {
            font-size: clamp(1.8rem, 3vw, 2.2rem);
            color: var(--color-dark);
            margin-bottom: 15px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            width: 80px;
            height: 4px;
            background-color: var(--color-accent);
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        /* åˆ†ç±»å¯¼èˆª */
        .categories {
            background-color: var(--color-white);
            padding: 60px 0;
            margin-bottom: 80px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            justify-items: center;
        }

        .category-card {
            text-align: center;
            padding: 30px 20px;
            border-radius: var(--radius-md);
            transition: var(--transition-base);
            border: 1px solid var(--color-light-gray);
            width: 100%;
            max-width: 200px;
            text-decoration: none;
            color: inherit;
        }

        .category-card:hover {
            background-color: var(--color-primary);
            color: var(--color-white);
            transform: translateY(-5px);
            border-color: var(--color-primary);
        }

        .category-card i {
            font-size: 2.5rem;
            color: var(--color-accent);
            margin-bottom: 15px;
            transition: var(--transition-fast);
        }

        .category-card:hover i {
            color: var(--color-white);
            transform: scale(1.1);
        }

        .category-card h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        /* åšå®¢å¡ç‰‡ */
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 40px;
            margin-bottom: 80px;
        }

        .post-card {
            background-color: var(--color-white);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: var(--transition-base);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .post-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .post-image {
            height: 220px;
            overflow: hidden;
            position: relative;
        }

        .post-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition-base);
        }

        .post-card:hover .post-image img {
            transform: scale(1.05);
        }

        .post-category {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: var(--color-accent);
            color: var(--color-white);
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .post-content {
            padding: 25px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .post-content h3 {
            color: var(--color-dark);
            font-size: 1.4rem;
            margin-bottom: 15px;
        }

        .post-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #6c757d;
            border-top: 1px solid var(--color-light-gray);
            padding-top: 15px;
            margin-top: auto;
        }

        .read-more {
            color: var(--color-accent);
            text-decoration: none;
            font-weight: 500;
        }

        /* é¡µè„š */
        footer {
            background-color: var(--color-dark);
            color: var(--color-white);
            padding: 80px 0 30px;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 50px;
        }

        .footer-col h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 15px;
        }

        .footer-col h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 3px;
            background-color: var(--color-accent);
        }

        .footer-col ul {
            list-style: none;
        }

        .footer-col ul li {
            margin-bottom: 10px;
        }

        .footer-col ul li a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-col ul li a:hover {
            color: var(--color-accent);
            padding-left: 5px;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-links a {
            color: white;
            font-size: 1.2rem;
            transition: var(--transition-base);
        }

        .social-links a:hover {
            color: var(--color-accent);
            transform: translateY(-3px);
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* å›åˆ°é¡¶éƒ¨æŒ‰é’® */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background-color: var(--color-accent);
            color: var(--color-white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: var(--transition-base);
            opacity: 0;
            visibility: hidden;
            z-index: 999;
            border: none;
        }

        .back-to-top.show {
            opacity: 1;
            visibility: visible;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
                position: absolute;
                top: 70px;
                left: 0;
                right: 0;
                background-color: var(--color-white);
                flex-direction: column;
                padding: 20px;
                box-shadow: var(--shadow-md);
                border-radius: var(--radius-sm);
                margin: 10px;
            }

            .nav-links li {
                margin: 10px 0;
            }

            .nav-links.show {
                display: flex;
            }

            .mobile-menu-btn {
                display: block;
            }

            .hero {
                padding: 80px 0;
            }

            .posts-grid {
                grid-template-columns: 1fr;
            }

            .visit-counter-box {
                top: auto;
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- è®¿é—®è®¡æ•° -->
    <div class="visit-counter-box" id="visitCounterBox">
        <i class="fas fa-eye"></i>
        <span>æ€»è®¿é—®é‡ï¼š<span class="visit-counter-number" id="visitCounterNumber">0</span>æ¬¡</span>
    </div>

    <header id="main-header">
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo">
                    <i class="fas fa-camera-retro"></i>
                    hyperçš„<span>Vlog</span>
                </a>
                
                <ul class="nav-links" id="navLinks">
                    <li><a href="#home">é¦–é¡µ</a></li>
                    <li><a href="#categories">åˆ†ç±»</a></li>
                    <li><a href="#blog">åšå®¢</a></li>
                    <li><a href="#about">å…³äºhyper</a></li>
                    <li><a href="#contact">è”ç³»æˆ‘</a></li>
                </ul>

                <!-- ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º -->
                <div class="user-status">
                    <div class="user-dropdown">
                        <button class="user-btn" id="userBtn">
                            <i class="fas fa-user-circle"></i>
                            <span id="usernameDisplay">æœªç™»å½•</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-menu" id="dropdownMenu">
                            <a href="/login/index.html" class="dropdown-item" id="loginItem">
                                <i class="fas fa-sign-in-alt"></i> ç™»å½•
                            </a>
                            <a href="/login/register.html" class="dropdown-item" id="registerItem">
                                <i class="fas fa-user-plus"></i> æ³¨å†Œ
                            </a>
                            <a href="javascript:void(0)" class="dropdown-item" id="logoutItem" onclick="handleLogout()" style="display: none;">
                                <i class="fas fa-sign-out-alt"></i> é€€å‡º
                            </a>
                        </div>
                    </div>
                </div>

                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>

    <section class="hero" id="home">
        <div class="container">
            <div class="hero-content">
                <h1>è®°å½•ç”Ÿæ´»ï¼Œåˆ†äº«æ•…äº‹</h1>
                <p>æ¬¢è¿æ¥åˆ°hyperçš„ä¸ªäººVlogç©ºé—´ï¼Œè¿™é‡Œè®°å½•äº†hyperçš„æ—¥å¸¸ç”Ÿæ´»ã€æ—…è¡Œç»å†å’Œæ€è€ƒæ„Ÿæ‚Ÿã€‚</p>
                <a href="#blog" class="hero-btn">
                    <i class="fas fa-book-open"></i> æµè§ˆæ›´å¤šå†…å®¹
                </a>
            </div>
        </div>
    </section>

    <section class="categories" id="categories">
        <div class="container">
            <div class="section-title">
                <h2>å†…å®¹åˆ†ç±»</h2>
                <p>æ¢ç´¢æˆ‘çš„Vlogä¸–ç•Œï¼Œå‘ç°ä¸åŒçš„ç”Ÿæ´»ç‰‡æ®µå’Œæ•…äº‹</p>
            </div>
            
            <div class="category-grid">
                <a href="/pages/travel/" class="category-card">
                    <i class="fas fa-map-marked-alt"></i>
                    <h3>æ—…æ¸¸è®°å½•</h3>
                    <p>èµ°éå±±æ²³ï¼Œè®°å½•ç¾å¥½</p>
                </a>
                
                <a href="/pages/diy/" class="category-card">
                    <i class="fas fa-desktop"></i>
                    <h3>è£…æœºè®°å½•</h3>
                    <p>æ•°ç çˆ±å¥½è€…çš„è£…æœºåˆ†äº«</p>
                </a>
                
                <a href="/pages/YYå¾€äº‹/" class="category-card">
                    <i class="fas fa-history"></i>
                    <h3>YYå¾€äº‹</h3>
                    <p>ç­çº§ç”Ÿæ´»ä¸æˆé•¿æ„Ÿæ‚Ÿ</p>
                </a>
                
                <a href="/pages/video/" class="category-card">
                    <i class="fas fa-video"></i>
                    <h3>è§†é¢‘åˆ›ä½œ</h3>
                    <p>è®°å½•ç”Ÿæ´»çš„è§†é¢‘ä½œå“</p>
                </a>
                
                <a href="/pages/devlog/" class="category-card">
                    <i class="fas fa-code"></i>
                    <h3>å¼€å‘æ—¥å¿—</h3>
                    <p>æŠ€æœ¯æ¢ç´¢ä¸ç½‘ç«™æ­å»ºè®°å½•</p>
                </a>
                
                <a href="/talk" class="category-card">
                    <i class="fas fa-comments"></i>
                    <h3>ç•™è¨€æ¿</h3>
                    <p>äº’åŠ¨äº¤æµï¼Œåˆ†äº«æƒ³æ³•</p>
                </a>
            </div>
        </div>
    </section>

    <section class="blog-posts" id="blog">
        <div class="container">
            <div class="section-title">
                <h2>æœ€æ–°åŠ¨æ€</h2>
                <p>è®°å½•ç”Ÿæ´»ä¸­çš„ç‚¹ç‚¹æ»´æ»´ï¼Œåˆ†äº«æ¯ä¸€ä¸ªç²¾å½©ç¬é—´</p>
            </div>
            
            <div class="posts-grid">
                <article class="post-card">
                    <div class="post-image">
                        <span class="post-category">å­¦ä¹ </span>
                        <img src="/pages/travel/2025.6.16-ä¸Šæµ·äº¤é€šå¤§å­¦é¢è¯•è®°-3days/ä¸Šæµ·äº¤é€šå¤§å­¦æ¬¢è¿æ‚¨.jpg" alt="ä¸Šæµ·äº¤é€šå¤§å­¦é¢è¯•è®°" loading="lazy">
                    </div>
                    <div class="post-content">
                        <h3>æˆ‘çš„ç¬¬ä¸€æ¬¡ç‹¬è‡ªæ—…è¡Œç»å†(ä¸Šäº¤é¢è¯•è®°)</h3>
                        <p>ç‹¬è‡ªæ—…è¡Œæ˜¯ä¸€æ¬¡ä¸è‡ªå·±å¯¹è¯çš„æ—…ç¨‹ï¼Œåœ¨ä¸Šæµ·çš„è¿™æ®µç»å†è®©æˆ‘æ”¶è·äº†å¾ˆå¤šï¼Œä¹Ÿå¯¹æœªæ¥æœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†ã€‚</p>
                        <div class="post-meta">
                            <span><i class="far fa-calendar"></i> 2025.06.16</span>
                            <a href="/pages/travel/2025.6.16-ä¸Šæµ·äº¤é€šå¤§å­¦é¢è¯•è®°-3days/" class="read-more">é˜…è¯»æ›´å¤š <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </article>
                
                <article class="post-card">
                    <div class="post-image">
                        <span class="post-category">æ—…è¡Œ</span>
                        <img src="/pages/travel/2025.7.24-ç™¾ä¸ˆæ¼ˆ/åœ¨ç™¾ä¸ˆä¸€æ¼ˆçš„åˆå½±.jpg" alt="ç™¾ä¸ˆæ¼ˆæ—…æ¸¸è®°" loading="lazy">
                    </div>
                    <div class="post-content">
                        <h3>æ°´å¸˜æ´ç©¿è¶Šè®° - ç™¾ä¸ˆæ¼ˆä¹‹è¡Œ</h3>
                        <p>ç™¾ä¸ˆæ¼ˆçš„ç€‘å¸ƒå¦‚é“¶æ²³å€’æ³»ï¼Œèº«ä¸´å…¶å¢ƒä»¿ä½›ç©¿è¶Šåˆ°äº†æ°´å¸˜æ´ï¼Œå¤§è‡ªç„¶çš„é¬¼æ–§ç¥å·¥ä»¤äººå¹ä¸ºè§‚æ­¢ã€‚</p>
                        <div class="post-meta">
                            <span><i class="far fa-calendar"></i> 2025.07.24</span>
                            <a href="/pages/travel/2025.7.24-ç™¾ä¸ˆæ¼ˆ/" class="read-more">é˜…è¯»æ›´å¤š <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </article>
                
                <article class="post-card">
                    <div class="post-image">
                        <span class="post-category">æ—…è¡Œ</span>
                        <img src="/pages/travel/2025.8.17-é›è¡å±±/å±±æ´é‡Œçš„åœ°ç“œ.jpg" alt="é›è¡å±±æ—…æ¸¸è®°" loading="lazy">
                    </div>
                    <div class="post-content">
                        <h3>é›è¡å±±æ—…æ¸¸è®° - å¥‡å³°å¼‚çŸ³é—´çš„è¡Œèµ°</h3>
                        <p>é›è¡å±±çš„å¥‡å³°æ€ªçŸ³ã€é£æ³‰ç€‘å¸ƒï¼Œæ¯ä¸€å¤„éƒ½å……æ»¡äº†è¯—æ„ï¼Œä¸€æ­¥ä¸€æ™¯ï¼Œæµè¿å¿˜è¿”ã€‚</p>
                        <div class="post-meta">
                            <span><i class="far fa-calendar"></i> 2025.08.17</span>
                            <a href="/pages/travel/2025.8.17-é›è¡å±±/" class="read-more">é˜…è¯»æ›´å¤š <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </article>
                
                <article class="post-card">
                    <div class="post-image">
                        <span class="post-category">å­¦ä¹ </span>
                        <img src="/pages/travel/2025.6.15-å—äº¬å¤§å­¦å¼ºåŸºè®°-2days/å—äº¬å¤§å­¦2.jpg" alt="å—äº¬å¤§å­¦å¼ºåŸºè®°" loading="lazy">
                    </div>
                    <div class="post-content">
                        <h3>å—äº¬å¤§å­¦å¼ºåŸºè®° - åæ ¡ä¹‹æ—…</h3>
                        <p>èµ°è¿›å—äº¬å¤§å­¦ï¼Œæ„Ÿå—ç™¾å¹´åæ ¡çš„æ–‡åŒ–åº•è•´ï¼Œå¼ºåŸºè®¡åˆ’çš„é¢è¯•ç»å†è®©æˆ‘å—ç›ŠåŒªæµ…ã€‚</p>
                        <div class="post-meta">
                            <span><i class="far fa-calendar"></i> 2025.06.15</span>
                            <a href="/pages/travel/2025.6.15-å—äº¬å¤§å­¦å¼ºåŸºè®°-2days/" class="read-more">é˜…è¯»æ›´å¤š <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </article>
                
                <article class="post-card">
                    <div class="post-image">
                        <span class="post-category">æ•°ç </span>
                        <img src="/pages/diy/RTX2060è£¸æœº.jpg" alt="è£…æœºè®°å½•" loading="lazy">
                    </div>
                    <div class="post-content">
                        <h3>è£…æœºè®°å½• - æˆ‘çš„DIYç”µè„‘æ­å»ºä¹‹æ—…</h3>
                        <p>ä»é…ä»¶é€‰è´­åˆ°ç»„è£…è°ƒè¯•ï¼Œä¸€æ­¥æ­¥æ­å»ºå±äºè‡ªå·±çš„ç”µè„‘ï¼Œä½“éªŒDIYçš„ä¹è¶£å’Œæˆå°±æ„Ÿã€‚</p>
                        <div class="post-meta">
                            <span><i class="far fa-calendar"></i> 2020-è‡³ä»Š</span>
                            <a href="/pages/diy/" class="read-more">é˜…è¯»æ›´å¤š <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </article>
                
                <article class="post-card">
                    <div class="post-image">
                        <span class="post-category">ç”Ÿæ´»</span>
                        <img src="/pages/travel/2024.7.28-ä¸Šæµ·æ—…æ¸¸-3days/å¤–æ»©.jpg" alt="ä¸Šæµ·æ—…æ¸¸" loading="lazy">
                    </div>
                    <div class="post-content">
                        <h3>ä¸Šæµ·æ—…æ¸¸è®° - å¤§åŸå¸‚çš„æ¢ç´¢</h3>
                        <p>å’ŒåŒå­¦ä»¬ä¸€èµ·å»ä¸Šæµ·æ—…è¡Œï¼Œåœ¨é«˜è€ƒå‰è§è§ä¸–é¢ï¼Œä¹Ÿå»äº†æœªæ¥æœ‰å¯èƒ½èƒ½ä¸Šçš„ä¸Šæµ·äº¤é€šå¤§å­¦ã€‚</p>
                        <div class="post-meta">
                            <span><i class="far fa-calendar"></i> 2024.7.28</span>
                            <a href="/pages/travel/2024.7.28-ä¸Šæµ·æ—…æ¸¸-3days/" class="read-more">é˜…è¯»æ›´å¤š <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <footer id="contact">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h3>å…³äºæˆ‘</h3>
                    <p>çƒ­çˆ±ç”Ÿæ´»ï¼Œå–œæ¬¢æ—…è¡Œå’Œè®°å½•ï¼Œç”¨Vlogçš„å½¢å¼åˆ†äº«ç”Ÿæ´»ä¸­çš„ç¾å¥½ç¬é—´å’Œæˆé•¿æ„Ÿæ‚Ÿã€‚</p>
                    <div class="social-links">
                        <a href="https://github.com/hyper152" target="_blank"><i class="fab fa-github"></i></a>
                        <a href="https://space.bilibili.com/1689598128" target="_blank"><i class="fab fa-bilibili"></i></a>
                        <a href="mailto:2361542526@qq.com"><i class="fas fa-envelope"></i></a>
                    </div>
                </div>
                
                <div class="footer-col">
                    <h3>å¿«é€Ÿé“¾æ¥</h3>
                    <ul>
                        <li><a href="#home"><i class="fas fa-home"></i> é¦–é¡µ</a></li>
                        <li><a href="#categories"><i class="fas fa-th-list"></i> å†…å®¹åˆ†ç±»</a></li>
                        <li><a href="#blog"><i class="fas fa-blog"></i> æœ€æ–°åŠ¨æ€</a></li>
                        <li><a href="/talk"><i class="fas fa-comment-dots"></i> ç•™è¨€æ¿</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h3>å†…å®¹åˆ†ç±»</h3>
                    <ul>
                        <li><a href="/pages/travel/"><i class="fas fa-map"></i> æ—…æ¸¸è®°å½•</a></li>
                        <li><a href="/pages/diy/"><i class="fas fa-laptop"></i> è£…æœºè®°å½•</a></li>
                        <li><a href="/pages/YYå¾€äº‹/"><i class="fas fa-history"></i> YYå¾€äº‹</a></li>
                        <li><a href="/pages/video/"><i class="fas fa-video"></i> è§†é¢‘åˆ›ä½œ</a></li>
                        <li><a href="/pages/devlog/"><i class="fas fa-code"></i> å¼€å‘æ—¥å¿—</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h3>è”ç³»æˆ‘</h3>
                    <ul>
                        <li><a href="tencent://message/?uin=2361542526"><i class="fab fa-qq"></i> QQï¼š2361542526</a></li>
                        <li><a href="#" onclick="alert('å¾®ä¿¡ï¼šhyper20070129')"><i class="fab fa-weixin"></i> å¾®ä¿¡ï¼šhyper20070129</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <div class="visit-count-footer">æ€»è®¿é—®é‡ï¼š<span id="footerVisitNumber">0</span> æ¬¡</div>
                <p>&copy; 2025 hyperçš„ä¸ªäººVlog | ä¿ç•™æ‰€æœ‰æƒåˆ©</p>
            </div>
        </div>
    </footer>

    <button class="back-to-top" id="backToTopBtn">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- å¼•å…¥è®¤è¯è„šæœ¬ -->
    <script src="/static/js/auth.js"></script>
    <script>
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const navLinks = document.getElementById('navLinks');
        
        mobileMenuBtn.addEventListener('click', () => {
            navLinks.classList.toggle('show');
            const icon = mobileMenuBtn.querySelector('i');
            icon.classList.toggle('fa-bars');
            icon.classList.toggle('fa-times');
        });

        // å¤´éƒ¨æ»šåŠ¨æ•ˆæœ
        const header = document.getElementById('main-header');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // å›åˆ°é¡¶éƒ¨
        const backToTopBtn = document.getElementById('backToTopBtn');
        window.addEventListener('scroll', () => {
            backToTopBtn.classList.toggle('show', window.scrollY > 300);
        });
        
        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // å¹³æ»‘æ»šåŠ¨
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                    navLinks.classList.remove('show');
                    const icon = mobileMenuBtn.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
        });

        // åŠ è½½è®¿é—®è®¡æ•° - ä¿®å¤ç‰ˆæœ¬ï¼Œæ”¯æŒå¤šç§æ•°æ®æ ¼å¼
        async function loadVisitCount() {
            try {
                const response = await fetch('/visit-count');
                const data = await response.json();
                
                let totalVisits = 0;
                
                // æ£€æŸ¥æ•°æ®æ ¼å¼å¹¶æå–è®¿é—®æ¬¡æ•°
                if (data.code === 200 && data.data) {
                    // æ ¼å¼1: {code:200, data:{total_visits:xxx}}
                    totalVisits = data.data.total_visits;
                } else if (data.total_visits !== undefined) {
                    // æ ¼å¼2: {total_visits:xxx}
                    totalVisits = data.total_visits;
                } else if (data.count !== undefined) {
                    // æ ¼å¼3: {count:xxx}
                    totalVisits = data.count;
                } else if (data.data && data.data.count) {
                    // æ ¼å¼4: {data:{count:xxx}}
                    totalVisits = data.data.count;
                }
                
                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('visitCounterNumber').textContent = totalVisits;
                document.getElementById('footerVisitNumber').textContent = totalVisits;
                
                console.log('è®¿é—®è®¡æ•°æ›´æ–°ä¸º:', totalVisits);
            } catch (error) {
                console.error('è·å–è®¿é—®è®¡æ•°å‡ºé”™:', error);
            }
        }

        // åˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€
        async function initUserStatus() {
            try {
                console.log('æ­£åœ¨æ£€æŸ¥ç™»å½•çŠ¶æ€...');
                const status = await Auth.checkLoginStatus();
                console.log('è·å–åˆ°çš„ç™»å½•çŠ¶æ€:', status);
                
                const usernameDisplay = document.getElementById('usernameDisplay');
                const loginItem = document.getElementById('loginItem');
                const registerItem = document.getElementById('registerItem');
                const logoutItem = document.getElementById('logoutItem');
                
                if (!usernameDisplay) {
                    console.error('æ‰¾ä¸åˆ°ç”¨æˆ·æ˜¾ç¤ºå…ƒç´ ');
                    return;
                }
                
                if (status.isLogin) {
                    console.log('ç”¨æˆ·å·²ç™»å½•:', status.user);
                    usernameDisplay.textContent = status.user.username || 'ç”¨æˆ·';
                    if (loginItem) loginItem.style.display = 'none';
                    if (registerItem) registerItem.style.display = 'none';
                    if (logoutItem) {
                        logoutItem.style.display = 'flex';
                        console.log('æ˜¾ç¤ºé€€å‡ºæŒ‰é’®');
                    }
                } else {
                    // å°è¯•ä»localStorageè·å–ç”¨æˆ·ä¿¡æ¯ä½œä¸ºå¤‡ä»½
                    const localUser = Auth.getLocalUser();
                    if (localUser) {
                        console.log('ä»localStorageæ¢å¤ç”¨æˆ·ä¿¡æ¯:', localUser);
                        usernameDisplay.textContent = localUser.username || 'ç”¨æˆ·';
                        if (loginItem) loginItem.style.display = 'none';
                        if (registerItem) registerItem.style.display = 'none';
                        if (logoutItem) logoutItem.style.display = 'flex';
                    } else {
                        console.log('ç”¨æˆ·æœªç™»å½•');
                        usernameDisplay.textContent = 'æœªç™»å½•';
                        if (loginItem) loginItem.style.display = 'flex';
                        if (registerItem) registerItem.style.display = 'flex';
                        if (logoutItem) logoutItem.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€å¤±è´¥:', error);
            }
        }

        // å¤„ç†ç™»å‡º
        window.handleLogout = async function() {
            const result = await Auth.logout();
            if (result.success) {
                alert('é€€å‡ºç™»å½•æˆåŠŸï¼');
                window.location.reload();
            } else {
                alert(result.message || 'é€€å‡ºå¤±è´¥');
            }
        };

        // ä¸‹æ‹‰èœå•
        const userBtn = document.getElementById('userBtn');
        const dropdownMenu = document.getElementById('dropdownMenu');
        
        if (userBtn) {
            userBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdownMenu.classList.toggle('show');
            });
        }
        
        document.addEventListener('click', function() {
            dropdownMenu.classList.remove('show');
        });

        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', () => {
            loadVisitCount();
            initUserStatus();
        });
    </script>
</body>
</html>
```

---

## File: login\index.html

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• | hyperçš„ä¸ªäººVlog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6a5acd;
            --accent: #ff6b6b;
            --light: #f8f9fa;
            --white: #ffffff;
            --gray: #495057;
            --light-gray: #e9ecef;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 40px;
            width: 100%;
            max-width: 400px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .login-header p {
            color: var(--gray);
        }

        .tab-nav {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--light-gray);
        }

        .tab-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            color: var(--gray);
            transition: all 0.3s ease;
        }

        .tab-item.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            margin-bottom: -2px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--gray);
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(106, 90, 205, 0.1);
        }

        .code-input {
            display: flex;
            gap: 10px;
        }

        .code-input .form-control {
            flex: 1;
        }

        .send-code-btn {
            width: 110px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .send-code-btn:hover {
            background: var(--accent);
        }

        .send-code-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-login {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 10px;
        }

        .btn-login:hover {
            background: var(--accent);
        }

        .register-link {
            text-align: center;
            margin-top: 20px;
        }

        .register-link a {
            color: var(--primary);
            text-decoration: none;
        }

        .register-link a:hover {
            color: var(--accent);
            text-decoration: underline;
        }

        .msg {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .msg.error {
            display: block;
            color: #dc3545;
            background: #f8d7da;
        }

        .msg.success {
            display: block;
            color: #28a745;
            background: #d4edda;
        }

        .msg.info {
            display: block;
            color: #17a2b8;
            background: #d1ecf1;
        }

        .manual-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
            transition: background 0.3s ease;
        }

        .manual-btn:hover {
            background: var(--accent);
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <h1><i class="fas fa-sign-in-alt"></i> è´¦å·ç™»å½•</h1>
            <p>æ¬¢è¿å›æ¥ï¼Œè¯·ç™»å½•åç»§ç»­</p>
        </div>

        <div class="msg" id="msg"></div>

        <div class="tab-nav">
            <div class="tab-item active" data-tab="password">å¯†ç ç™»å½•</div>
            <div class="tab-item" data-tab="code">éªŒè¯ç ç™»å½•</div>
        </div>

        <!-- å¯†ç ç™»å½•è¡¨å• -->
        <form id="passwordLoginForm">
            <div class="form-group">
                <label for="email">é‚®ç®±</label>
                <input type="email" id="email" class="form-control" placeholder="è¯·è¾“å…¥æ³¨å†Œé‚®ç®±" required>
            </div>
            <div class="form-group">
                <label for="password">å¯†ç </label>
                <input type="password" id="password" class="form-control" placeholder="è¯·è¾“å…¥å¯†ç " required>
            </div>
            <button type="submit" class="btn-login">ç™»å½•</button>
        </form>

        <!-- éªŒè¯ç ç™»å½•è¡¨å• -->
        <form id="codeLoginForm" style="display: none;">
            <div class="form-group">
                <label for="codeEmail">é‚®ç®±</label>
                <input type="email" id="codeEmail" class="form-control" placeholder="è¯·è¾“å…¥æ³¨å†Œé‚®ç®±" required>
            </div>
            <div class="form-group">
                <label for="code">éªŒè¯ç </label>
                <div class="code-input">
                    <input type="text" id="code" class="form-control" placeholder="6ä½éªŒè¯ç " maxlength="6" required>
                    <button type="button" class="send-code-btn" id="sendCodeBtn">å‘é€éªŒè¯ç </button>
                </div>
            </div>
            <button type="submit" class="btn-login">ç™»å½•</button>
        </form>

        <div class="register-link">
            è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ <a href="register.html">ç«‹å³æ³¨å†Œ</a>
        </div>
    </div>

    <script src="/static/js/auth.js"></script>
    <script>
        // è·å–å…ƒç´ 
        const tabs = document.querySelectorAll('.tab-item');
        const passwordForm = document.getElementById('passwordLoginForm');
        const codeForm = document.getElementById('codeLoginForm');
        const msg = document.getElementById('msg');
        const sendCodeBtn = document.getElementById('sendCodeBtn');
        let countdown = 0;

        // åˆ‡æ¢ç™»å½•æ–¹å¼
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                if (tab.dataset.tab === 'password') {
                    passwordForm.style.display = 'block';
                    codeForm.style.display = 'none';
                } else {
                    passwordForm.style.display = 'none';
                    codeForm.style.display = 'block';
                }
                msg.style.display = 'none';
            });
        });

        // å‘é€éªŒè¯ç 
        sendCodeBtn.addEventListener('click', async () => {
            const email = document.getElementById('codeEmail').value.trim();
            
            if (!email) {
                showMessage('è¯·è¾“å…¥é‚®ç®±', 'error');
                return;
            }
            
            if (!email.includes('@') || !email.includes('.')) {
                showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€', 'error');
                return;
            }
            
            if (countdown > 0) return;

            try {
                sendCodeBtn.disabled = true;
                sendCodeBtn.textContent = 'å‘é€ä¸­...';
                
                const res = await fetch('/api/login/send-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                
                const data = await res.json();
                
                if (data.code === 200) {
                    showMessage(data.msg, 'success');
                    
                    // å¼€å§‹å€’è®¡æ—¶
                    countdown = 60;
                    sendCodeBtn.textContent = `é‡æ–°å‘é€(${countdown}s)`;
                    
                    const timer = setInterval(() => {
                        countdown--;
                        sendCodeBtn.textContent = `é‡æ–°å‘é€(${countdown}s)`;
                        if (countdown <= 0) {
                            clearInterval(timer);
                            sendCodeBtn.disabled = false;
                            sendCodeBtn.textContent = 'å‘é€éªŒè¯ç ';
                        }
                    }, 1000);
                } else {
                    showMessage(data.msg, 'error');
                    sendCodeBtn.disabled = false;
                    sendCodeBtn.textContent = 'å‘é€éªŒè¯ç ';
                }
            } catch (err) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', 'error');
                sendCodeBtn.disabled = false;
                sendCodeBtn.textContent = 'å‘é€éªŒè¯ç ';
                console.error(err);
            }
        });

        // å¯†ç ç™»å½•
        passwordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!email || !password) {
                showMessage('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯', 'error');
                return;
            }

            try {
                const res = await fetch('/api/login/password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await res.json();

                if (data.code === 200) {
                    // ä¿å­˜åˆ°localStorage
                    Auth.saveLoginInfo(data.data.session_id, {
                        username: data.data.username,
                        email: data.data.email
                    });
                    
                    showMessage('ç™»å½•æˆåŠŸï¼', 'success');
                    
                    console.log('ç™»å½•æˆåŠŸï¼Œsession_id:', data.data.session_id);
                    console.log('å½“å‰cookies:', document.cookie);
                    
                    // æ˜¾ç¤ºæ‰‹åŠ¨è·³è½¬æŒ‰é’®
                    const manualBtn = document.createElement('button');
                    manualBtn.textContent = 'ç‚¹å‡»è¿›å…¥é¦–é¡µ';
                    manualBtn.className = 'manual-btn';
                    manualBtn.onclick = () => {
                        const redirect = new URLSearchParams(window.location.search).get('redirect') || '/home/index.html';
                        window.location.href = redirect;
                    };
                    
                    // ç§»é™¤ä¹‹å‰çš„æŒ‰é’®ï¼ˆå¦‚æœæœ‰ï¼‰
                    const oldBtn = document.querySelector('.manual-btn');
                    if (oldBtn) oldBtn.remove();
                    
                    document.querySelector('.login-container').appendChild(manualBtn);
                } else {
                    showMessage(data.msg, 'error');
                }
            } catch (err) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', 'error');
                console.error(err);
            }
        });

        // éªŒè¯ç ç™»å½•
        codeForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('codeEmail').value.trim();
            const code = document.getElementById('code').value.trim();

            if (!email || !code) {
                showMessage('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯', 'error');
                return;
            }

            try {
                const res = await fetch('/api/login/code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, code })
                });
                
                const data = await res.json();

                if (data.code === 200) {
                    Auth.saveLoginInfo(data.data.session_id, {
                        username: data.data.username,
                        email: data.data.email
                    });
                    
                    showMessage('ç™»å½•æˆåŠŸï¼', 'success');
                    
                    console.log('ç™»å½•æˆåŠŸï¼Œsession_id:', data.data.session_id);
                    console.log('å½“å‰cookies:', document.cookie);
                    
                    // æ˜¾ç¤ºæ‰‹åŠ¨è·³è½¬æŒ‰é’®
                    const manualBtn = document.createElement('button');
                    manualBtn.textContent = 'ç‚¹å‡»è¿›å…¥é¦–é¡µ';
                    manualBtn.className = 'manual-btn';
                    manualBtn.onclick = () => {
                        const redirect = new URLSearchParams(window.location.search).get('redirect') || '/home/index.html';
                        window.location.href = redirect;
                    };
                    
                    // ç§»é™¤ä¹‹å‰çš„æŒ‰é’®ï¼ˆå¦‚æœæœ‰ï¼‰
                    const oldBtn = document.querySelector('.manual-btn');
                    if (oldBtn) oldBtn.remove();
                    
                    document.querySelector('.login-container').appendChild(manualBtn);
                } else {
                    showMessage(data.msg, 'error');
                }
            } catch (err) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', 'error');
                console.error(err);
            }
        });

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type = 'info') {
            msg.textContent = text;
            msg.className = 'msg ' + type;
            msg.style.display = 'block';
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰é‡å®šå‘å‚æ•°
        const params = new URLSearchParams(window.location.search);
        if (params.get('redirect')) {
            showMessage('è¯·å…ˆç™»å½•åç»§ç»­æ“ä½œ', 'info');
        }
    </script>
</body>
</html>
```

---

## File: login\register.html

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨å†Œ | hyperçš„ä¸ªäººVlog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6a5acd;
            --accent: #ff6b6b;
            --light: #f8f9fa;
            --white: #ffffff;
            --gray: #495057;
            --light-gray: #e9ecef;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: var(--light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .register-container {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 40px;
            width: 100%;
            max-width: 450px;
        }

        .register-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .register-header h1 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .register-header p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--gray);
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(106, 90, 205, 0.1);
        }

        .form-control.error {
            border-color: #dc3545;
        }

        .code-input {
            display: flex;
            gap: 10px;
        }

        .code-input .form-control {
            flex: 1;
        }

        .send-code-btn {
            width: 120px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .send-code-btn:hover {
            background: var(--accent);
        }

        .send-code-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-register {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 10px;
        }

        .btn-register:hover {
            background: var(--accent);
        }

        .btn-register:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .login-link {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .login-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .login-link a:hover {
            color: var(--accent);
            text-decoration: underline;
        }

        .msg {
            text-align: center;
            margin-bottom: 15px;
            min-height: 24px;
            font-size: 0.9rem;
            padding: 8px;
            border-radius: 4px;
        }

        .msg.error {
            color: #dc3545;
            background: #f8d7da;
        }

        .msg.success {
            color: #28a745;
            background: #d4edda;
        }

        .msg.info {
            color: #17a2b8;
            background: #d1ecf1;
        }

        .password-strength {
            height: 4px;
            margin-top: 8px;
            border-radius: 2px;
            background: #eee;
            overflow: hidden;
        }

        .strength-bar {
            height: 100%;
            width: 0;
            transition: all 0.3s ease;
        }

        .strength-weak {
            background: #dc3545;
            width: 33.33%;
        }

        .strength-medium {
            background: #ffc107;
            width: 66.66%;
        }

        .strength-strong {
            background: #28a745;
            width: 100%;
        }

        @media (max-width: 480px) {
            .register-container {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="register-container">
        <div class="register-header">
            <h1><i class="fas fa-user-plus"></i> è´¦å·æ³¨å†Œ</h1>
            <p>ä½¿ç”¨é‚®ç®±æ³¨å†Œï¼Œäº«å—å®Œæ•´åŠŸèƒ½</p>
        </div>

        <!-- æ¶ˆæ¯æç¤º -->
        <div class="msg" id="msg"></div>

        <!-- æ³¨å†Œè¡¨å• -->
        <form id="registerForm">
            <div class="form-group">
                <label for="username">ç”¨æˆ·å</label>
                <input type="text" id="username" class="form-control" placeholder="2-20ä¸ªå­—ç¬¦" maxlength="20" required>
                <div style="font-size:12px; color:#999; margin-top:4px;">2-20ä¸ªå­—ç¬¦ï¼Œå¯ç”±ä¸­æ–‡ã€å­—æ¯ã€æ•°å­—ç»„æˆ</div>
            </div>

            <div class="form-group">
                <label for="email">é‚®ç®±</label>
                <input type="email" id="email" class="form-control" placeholder="ç”¨äºç™»å½•å’Œæ¥æ”¶éªŒè¯ç " required>
            </div>

            <div class="form-group">
                <label for="code">éªŒè¯ç </label>
                <div class="code-input">
                    <input type="text" id="code" class="form-control" placeholder="è¯·è¾“å…¥6ä½éªŒè¯ç " maxlength="6" required>
                    <button type="button" class="send-code-btn" id="sendCodeBtn">å‘é€éªŒè¯ç </button>
                </div>
            </div>

            <div class="form-group">
                <label for="password">å¯†ç </label>
                <input type="password" id="password" class="form-control" placeholder="è‡³å°‘6ä½" required>
                <div class="password-strength">
                    <div class="strength-bar" id="strengthBar"></div>
                </div>
                <div style="font-size:12px; color:#999; margin-top:4px;">è‡³å°‘6ä½ï¼Œå»ºè®®ä½¿ç”¨å­—æ¯+æ•°å­—ç»„åˆ</div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">ç¡®è®¤å¯†ç </label>
                <input type="password" id="confirmPassword" class="form-control" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required>
            </div>

            <button type="submit" class="btn-register" id="registerBtn">æ³¨å†Œ</button>
        </form>

        <div class="login-link">
            å·²æœ‰è´¦å·ï¼Ÿ<a href="index.html">ç«‹å³ç™»å½•</a>
        </div>
    </div>

    <script>
        // è·å–å…ƒç´ 
        const msg = document.getElementById('msg');
        const sendCodeBtn = document.getElementById('sendCodeBtn');
        const registerForm = document.getElementById('registerForm');
        const registerBtn = document.getElementById('registerBtn');
        
        // å¯†ç å¼ºåº¦æ£€æµ‹
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const strengthBar = document.getElementById('strengthBar');

        // æ£€æŸ¥å¯†ç å¼ºåº¦
        function checkPasswordStrength(password) {
            let strength = 0;
            
            if (password.length >= 6) strength += 1;
            if (password.length >= 8) strength += 1;
            if (/[a-z]/.test(password) && /[0-9]/.test(password)) strength += 1;
            if (/[A-Z]/.test(password)) strength += 1;
            if (/[!@#$%^&*]/.test(password)) strength += 1;
            
            return Math.min(strength, 3); // 0-3çº§
        }

        passwordInput.addEventListener('input', function() {
            const strength = checkPasswordStrength(this.value);
            
            strengthBar.className = 'strength-bar';
            if (strength === 1) {
                strengthBar.classList.add('strength-weak');
            } else if (strength === 2) {
                strengthBar.classList.add('strength-medium');
            } else if (strength >= 3) {
                strengthBar.classList.add('strength-strong');
            }
        });

        // å‘é€éªŒè¯ç 
        let countdown = 0;
        let countdownTimer = null;

        sendCodeBtn.addEventListener('click', async function() {
            const email = document.getElementById('email').value.trim();
            
            if (!email) {
                showMessage('è¯·è¾“å…¥é‚®ç®±', 'error');
                document.getElementById('email').focus();
                return;
            }
            
            if (!email.includes('@') || !email.includes('.')) {
                showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€', 'error');
                return;
            }
            
            if (countdown > 0) return;

            try {
                sendCodeBtn.disabled = true;
                sendCodeBtn.textContent = 'å‘é€ä¸­...';
                
                const res = await fetch('/api/register/send-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                
                const data = await res.json();
                
                if (data.code === 200) {
                    showMessage(data.msg, 'success');
                    
                    // å¼€å§‹å€’è®¡æ—¶
                    countdown = 60;
                    sendCodeBtn.textContent = `é‡æ–°å‘é€(${countdown}s)`;
                    
                    if (countdownTimer) clearInterval(countdownTimer);
                    
                    countdownTimer = setInterval(() => {
                        countdown--;
                        sendCodeBtn.textContent = `é‡æ–°å‘é€(${countdown}s)`;
                        
                        if (countdown <= 0) {
                            clearInterval(countdownTimer);
                            sendCodeBtn.disabled = false;
                            sendCodeBtn.textContent = 'å‘é€éªŒè¯ç ';
                        }
                    }, 1000);
                } else {
                    showMessage(data.msg, 'error');
                    sendCodeBtn.disabled = false;
                    sendCodeBtn.textContent = 'å‘é€éªŒè¯ç ';
                }
            } catch (err) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', 'error');
                sendCodeBtn.disabled = false;
                sendCodeBtn.textContent = 'å‘é€éªŒè¯ç ';
                console.error(err);
            }
        });

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type = 'info') {
            msg.textContent = text;
            msg.className = 'msg ' + type;
            
            // 3ç§’åè‡ªåŠ¨æ¸…é™¤æˆåŠŸæ¶ˆæ¯
            if (type === 'success') {
                setTimeout(() => {
                    msg.textContent = '';
                    msg.className = 'msg';
                }, 3000);
            }
        }

        // è¡¨å•æäº¤
        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const code = document.getElementById('code').value.trim();
            const password = document.getElementById('password').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            
            // è¡¨å•éªŒè¯
            if (!username) {
                showMessage('è¯·è¾“å…¥ç”¨æˆ·å', 'error');
                return;
            }
            
            if (username.length < 2 || username.length > 20) {
                showMessage('ç”¨æˆ·åé•¿åº¦ä¸º2-20ä¸ªå­—ç¬¦', 'error');
                return;
            }
            
            if (!email) {
                showMessage('è¯·è¾“å…¥é‚®ç®±', 'error');
                return;
            }
            
            if (!code || code.length !== 6) {
                showMessage('è¯·è¾“å…¥6ä½éªŒè¯ç ', 'error');
                return;
            }
            
            if (!password) {
                showMessage('è¯·è¾“å…¥å¯†ç ', 'error');
                return;
            }
            
            if (password.length < 6) {
                showMessage('å¯†ç é•¿åº¦è‡³å°‘6ä½', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }

            // ç¦ç”¨æäº¤æŒ‰é’®
            registerBtn.disabled = true;
            registerBtn.textContent = 'æ³¨å†Œä¸­...';

            try {
                const res = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username,
                        email,
                        password,
                        code
                    })
                });
                
                const data = await res.json();
                
                if (data.code === 200) {
                    showMessage(data.msg, 'success');
                    
                    // æ³¨å†ŒæˆåŠŸï¼Œ3ç§’åè·³è½¬åˆ°ç™»å½•é¡µ
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 3000);
                } else {
                    showMessage(data.msg, 'error');
                    registerBtn.disabled = false;
                    registerBtn.textContent = 'æ³¨å†Œ';
                }
            } catch (err) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', 'error');
                registerBtn.disabled = false;
                registerBtn.textContent = 'æ³¨å†Œ';
                console.error(err);
            }
        });
    </script>
</body>
</html>
```

---

## File: main.py

```py
# -*- coding: utf-8 -*-
"""
ä¸ªäººVlog HTTPæœåŠ¡ç«¯ï¼ˆå®‰å…¨å¢å¼ºç‰ˆï¼‰
âœ… ä¿®å¤ï¼šè®¿é—®åŠ¨æ€é‡å¤æ‰“å°ï¼ˆæ•´åˆä¸ºä¸€è¡Œï¼‰
âœ… ä¿®å¤ï¼š/visit-countæ¥å£è§¦å‘è®¡æ•°å¢åŠ 
âœ… ä¿®å¤ï¼šbytesä»…æ”¯æŒASCIIå­—ç¬¦çš„è¯­æ³•é”™è¯¯
âœ… ä¿®å¤ï¼š/talk è·¯å¾„404é—®é¢˜ï¼ˆæ˜ å°„åˆ°é™æ€é¡µé¢ï¼‰
âœ… ä¿®å¤ï¼šç™»å½•åæ— æ³•ç•™è¨€ï¼ˆå¯¼å…¥é”™è¯¯+å®¹é”™é€»è¾‘ï¼‰
âœ… æ–°å¢ï¼šè®¿é—®åŠ¨æ€è¾“å‡ºç”¨æˆ·ä¿¡æ¯
âœ… æ–°å¢ï¼šæ•°æ®ç›®å½•è®¿é—®ä¿æŠ¤
âœ… æ–°å¢ï¼šæ•æ„Ÿæ–‡ä»¶è®¿é—®é™åˆ¶
âœ… ä¿ç•™ï¼šæ‰€æœ‰åŸæœ‰åŠŸèƒ½ï¼ˆç›®å½•ç¾åŒ–ã€ç•™è¨€æ¿ã€å¼‚æ­¥è®¡æ•°ç­‰ï¼‰
"""
import socket
import sys
import os
import time
import json
import logging
import argparse
import contextlib
from functools import partial
from datetime import datetime
from collections import defaultdict
from http.server import CGIHTTPRequestHandler, ThreadingHTTPServer
from urllib.parse import unquote, urlparse

# ===================== é…ç½®æŠ½ç¦» =====================
class Config:
    HOST = "0.0.0.0"
    PORT = 8000
    SERVER_DIR = None

    RATE_LIMIT = 60
    RATE_LIMIT_WINDOW = 60
    MAX_POST_SIZE = 1 * 1024 * 1024
    ALLOWED_EXTENSIONS = None

    LOG_DIR = "logs"
    LOG_LEVEL = logging.INFO
    LOG_ROTATE = True

    # æ’é™¤è®¡æ•°çš„è·¯å¾„
    EXCLUDE_COUNT_PATHS = ['/visit-count']
    EXCLUDE_STATIC_EXT = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.css', '.js', '.ico', '.svg']
    RESET_VISITS = False
    
    # æ•æ„Ÿæ–‡ä»¶åˆ—è¡¨
    SENSITIVE_FILES = ['users.json', 'sessions.json', 'messages.json', 'visit_count.json']
    # ä¿æŠ¤çš„æ•°æ®ç›®å½•
    PROTECTED_DIRS = ['/data/', '/data\\']

# ===================== æ—¥å¿—åˆå§‹åŒ– =====================
def init_logging():
    """åˆå§‹åŒ–æ—¥å¿—ï¼šåŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°+æ–‡ä»¶"""
    log_dir = os.path.join(os.path.dirname(os.path.abspath(__file__)), Config.LOG_DIR)
    os.makedirs(log_dir, exist_ok=True)
    log_filename = f"access_{datetime.now().strftime('%Y%m%d')}.log" if Config.LOG_ROTATE else "access.log"
    log_file = os.path.join(log_dir, log_filename)

    # è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼
    class AccessDynamicFormatter(logging.Formatter):
        def format(self, record):
            if record.msg.startswith("[è®¿é—®åŠ¨æ€]"):
                self._style._fmt = "%(message)s"
            else:
                self._style._fmt = "%(asctime)s - %(levelname)s - %(message)s"
            return super().format(record)

    # æ§åˆ¶å°å¤„ç†å™¨
    console_handler = logging.StreamHandler(sys.stdout)
    console_handler.setFormatter(AccessDynamicFormatter(datefmt="%Y-%m-%d %H:%M:%S"))

    # æ–‡ä»¶å¤„ç†å™¨
    file_handler = logging.FileHandler(log_file, encoding='utf-8')
    file_handler.setFormatter(logging.Formatter(
        "%(asctime)s - %(levelname)s - %(message)s",
        datefmt="%Y-%m-%d %H:%M:%S"
    ))

    # é…ç½®æ—¥å¿—
    logging.basicConfig(
        level=Config.LOG_LEVEL,
        handlers=[file_handler, console_handler]
    )
    return logging.getLogger(__name__)

logger = init_logging()

# ===================== ç›®å½•åˆ›å»º =====================
current_script_dir = os.path.dirname(os.path.abspath(__file__))
data_dir = os.path.join(current_script_dir, 'data')
src_dir = os.path.join(current_script_dir, 'src')
home_dir = os.path.join(current_script_dir, 'home')
talk_dir = os.path.join(current_script_dir, 'talk')

for d in [data_dir, src_dir, home_dir, talk_dir]:
    try:
        os.makedirs(d, exist_ok=True)
    except Exception as e:
        logger.warning(f"åˆ›å»ºç›®å½• {d} å¤±è´¥ï¼š{e}")

# åœ¨dataç›®å½•åˆ›å»ºindex.htmlé˜²æ­¢ç›®å½•æµè§ˆ
data_index_path = os.path.join(data_dir, 'index.html')
if not os.path.exists(data_index_path):
    try:
        with open(data_index_path, 'w', encoding='utf-8') as f:
            f.write("""<!DOCTYPE html>
<html>
<head><title>ç¦æ­¢è®¿é—®</title></head>
<body style="background:#f8f9fa; text-align:center; padding:50px;">
    <h1 style="color:#6a5acd;">403 Forbidden</h1>
    <p style="color:#495057;">ä½ æ²¡æœ‰æƒé™è®¿é—®æ­¤ç›®å½•</p>
</body>
</html>""")
    except Exception as e:
        logger.warning(f"åˆ›å»ºdataç›®å½•ä¿æŠ¤æ–‡ä»¶å¤±è´¥ï¼š{e}")

sys.path.insert(0, src_dir)

# ===================== ä¾èµ–å¯¼å…¥ =====================
FLASK_AVAILABLE = False
try:
    import message_board
    FLASK_AVAILABLE = True
    logger.info("âœ… ç•™è¨€æ¿æ¨¡å—å¯¼å…¥æˆåŠŸ")
except ImportError as e:
    logger.warning(f"âš ï¸ ç•™è¨€æ¿æ¨¡å—å¯¼å…¥å¤±è´¥ï¼š{e}")

# å¯¼å…¥è®¤è¯æ¨¡å—è·å–ç”¨æˆ·ä¿¡æ¯
try:
    from src.auth import get_current_user, check_login_status
    AUTH_AVAILABLE = True
    logger.info("âœ… è®¤è¯æ¨¡å—å¯¼å…¥æˆåŠŸ")
except ImportError as e:
    logger.warning(f"âš ï¸ è®¤è¯æ¨¡å—å¯¼å…¥å¤±è´¥ï¼š{e}")
    AUTH_AVAILABLE = False
    # å®šä¹‰ç©ºå‡½æ•°é¿å…é”™è¯¯
    def get_current_user(session_id): return {}
    def check_login_status(session_id): return False

# ç®€åŒ–è®¿é—®è®¡æ•°ï¼ˆå†…ç½®ç‰ˆï¼Œæ— éœ€é¢å¤–æ¨¡å—ï¼‰
VISIT_COUNT_FILE = os.path.join(data_dir, 'visit_count.json')
def count_visit():
    """è®¡æ•°è®¿é—®é‡"""
    try:
        if not os.path.exists(VISIT_COUNT_FILE):
            with open(VISIT_COUNT_FILE, 'w', encoding='utf-8') as f:
                json.dump({"count": 0, "total_visits": 0}, f)
        
        with open(VISIT_COUNT_FILE, 'r+', encoding='utf-8') as f:
            data = json.load(f)
            current_count = data.get("count", 0)
            data["count"] = current_count + 1
            data["total_visits"] = data["count"]  # åŒæ­¥total_visits
            data["update_time"] = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            f.seek(0)
            json.dump(data, f, ensure_ascii=False, indent=4)
            f.truncate()
        return data["count"]
    except Exception as e:
        logger.error(f"è®¡æ•°å¤±è´¥ï¼š{e}")
        return 0

def get_total_visits():
    """è·å–æ€»è®¿é—®é‡"""
    try:
        if not os.path.exists(VISIT_COUNT_FILE):
            return 0
        with open(VISIT_COUNT_FILE, 'r', encoding='utf-8') as f:
            data = json.load(f)
        return data.get("count", data.get("total_visits", 0))
    except Exception as e:
        logger.error(f"è·å–è®¡æ•°å¤±è´¥ï¼š{e}")
        return 0

def get_session_id_from_request(request_handler):
    """ä»è¯·æ±‚ä¸­è·å–session_id"""
    # ä»cookieè·å–
    cookie_header = request_handler.headers.get('Cookie', '')
    cookies = {}
    for cookie in cookie_header.split(';'):
        if '=' in cookie:
            key, value = cookie.strip().split('=', 1)
            cookies[key] = value
    
    session_id = cookies.get('session_id', '')
    if session_id:
        return session_id
    
    # ä»Authorizationå¤´è·å–
    auth_header = request_handler.headers.get('Authorization', '')
    if auth_header.startswith('Session '):
        session_id = auth_header[8:].strip()
        return session_id
    
    return ''

def get_user_info_from_request(request_handler):
    """ä»è¯·æ±‚ä¸­è·å–ç”¨æˆ·ä¿¡æ¯"""
    if not AUTH_AVAILABLE:
        return {}
    
    session_id = get_session_id_from_request(request_handler)
    if not session_id:
        return {}
    
    if not check_login_status(session_id):
        return {}
    
    return get_current_user(session_id)

# ===================== HTTP å¤„ç†å™¨ =====================
class BeautifulDirectoryHandler(CGIHTTPRequestHandler):
    ip_request_cache = defaultdict(list)

    def __init__(self, *args, **kwargs):
        self.request_handled = False
        super().__init__(*args, **kwargs)

    def log_message(self, format, *args):
        """è¦†ç›–é»˜è®¤æ—¥å¿—"""
        try:
            client_ip = self.address_string()
            logger.info(f"[è®¿é—®æ—¥å¿—] {client_ip} - {format % args}")
        except Exception as e:
            logger.error(f"æ—¥å¿—æ‰“å°å¼‚å¸¸ï¼š{e}")

    def check_rate_limit(self):
        """é™æµæ£€æŸ¥"""
        try:
            client_ip = self.address_string()
            now = time.time()
            self.ip_request_cache[client_ip] = [t for t in self.ip_request_cache[client_ip] if now - t < Config.RATE_LIMIT_WINDOW]
            
            # APIè¯·æ±‚æ›´ä¸¥æ ¼çš„é™åˆ¶
            if self.path.startswith('/api/'):
                if len(self.ip_request_cache[client_ip]) >= 30:  # APIæ¯åˆ†é’Ÿ30æ¬¡
                    self.send_response(429)
                    self.send_header("Content-type", "text/html; charset=utf-8")
                    self.end_headers()
                    error_html = """
                    <html>
                    <head><title>429 Too Many Requests</title></head>
                    <body style='padding:40px'>
                        <h1>429 APIè¯·æ±‚é¢‘ç‡è¿‡é«˜</h1>
                        <p>APIè¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼Œè¯·ç¨åå†è¯•</p>
                    </body>
                    </html>
                    """
                    self.wfile.write(error_html.encode('utf-8'))
                    return False
            
            # æ™®é€šè¯·æ±‚é™åˆ¶
            elif len(self.ip_request_cache[client_ip]) >= Config.RATE_LIMIT:
                self.send_response(429)
                self.send_header("Content-type", "text/html; charset=utf-8")
                self.end_headers()
                error_html = """
                <html>
                <head><title>429 Too Many Requests</title></head>
                <body style='padding:40px'>
                    <h1>429 è¯·æ±‚é¢‘ç‡è¿‡é«˜</h1>
                    <p>è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼Œè¯·60ç§’åå†è¯•</p>
                </body>
                </html>
                """
                self.wfile.write(error_html.encode('utf-8'))
                return False
                
            self.ip_request_cache[client_ip].append(now)
            return True
        except Exception as e:
            logger.error(f"é™æµæ£€æŸ¥å¼‚å¸¸ï¼š{e}")
            return True

    def validate_path(self, path):
        """è·¯å¾„æ ¡éªŒ"""
        try:
            safe_path = os.path.abspath(path)
            server_root = os.path.abspath(self.directory)
            
            # å®‰å…¨æ£€æŸ¥ï¼šé˜²æ­¢è·¯å¾„éå†
            if not safe_path.startswith(server_root):
                logger.warning(f"ç¦æ­¢è®¿é—®ï¼šéæ³•è·¯å¾„ {path}")
                self.send_error(403, "ç¦æ­¢è®¿é—®ï¼šéæ³•è·¯å¾„")
                return None
                
            return safe_path
        except Exception as e:
            logger.error(f"è·¯å¾„æ ¡éªŒå¼‚å¸¸ï¼š{e}")
            self.send_error(400, "è·¯å¾„æ ¼å¼é”™è¯¯")
            return None

    def is_protected_path(self, path):
        """æ£€æŸ¥æ˜¯å¦æ˜¯å—ä¿æŠ¤çš„è·¯å¾„"""
        # æ£€æŸ¥æ˜¯å¦æ˜¯æ•°æ®ç›®å½•
        for protected_dir in Config.PROTECTED_DIRS:
            if path.startswith(protected_dir):
                return True
        
        # æ£€æŸ¥æ˜¯å¦æ˜¯æ•æ„Ÿæ–‡ä»¶
        for sensitive_file in Config.SENSITIVE_FILES:
            if path.endswith(f'/data/{sensitive_file}') or path.endswith(f'\\data\\{sensitive_file}'):
                return True
        
        return False

    def handle_one_request(self):
        """å¤„ç†å•ä¸ªè¯·æ±‚"""
        if self.request_handled:
            return
        self.request_handled = True

        if not self.check_rate_limit():
            return

        try:
            super().handle_one_request()
        except Exception as e:
            logger.error(f"[è¯·æ±‚å¤„ç†å¼‚å¸¸] {e}")
            return

        # è®¿é—®åŠ¨æ€ç»Ÿè®¡ï¼ˆå¸¦ç”¨æˆ·ä¿¡æ¯ï¼‰
        try:
            visit_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S.%f")[:-3]
            client_ip = self.address_string()
            request_path = getattr(self, 'path', 'æœªçŸ¥è·¯å¾„')
            request_method = getattr(self, 'command', 'æœªçŸ¥æ–¹æ³•')
            
            # è·å–ç”¨æˆ·ä¿¡æ¯
            user_info = get_user_info_from_request(self)
            username = user_info.get('username', '') if user_info else ''
            
            # è®¡æ•°è®¿é—®
            is_static = any(request_path.lower().endswith(ext) for ext in Config.EXCLUDE_STATIC_EXT)
            is_exclude_path = any(request_path.startswith(path) for path in Config.EXCLUDE_COUNT_PATHS)
            
            if not is_static and not is_exclude_path:
                total_visits = count_visit()
            else:
                total_visits = get_total_visits()

            # æ„å»ºè®¿é—®åŠ¨æ€ä¿¡æ¯
            if username:
                access_msg = f"[è®¿é—®åŠ¨æ€] {visit_time} | ç”¨æˆ·: {username} | IP: {client_ip} | {request_method} | {request_path} | æ€»è®¿é—®é‡ï¼š{total_visits}"
            else:
                access_msg = f"[è®¿é—®åŠ¨æ€] {visit_time} | æ¸¸å®¢ | IP: {client_ip} | {request_method} | {request_path} | æ€»è®¿é—®é‡ï¼š{total_visits}"
            
            logger.info(access_msg)
            
        except Exception as e:
            logger.error(f"[è®¿é—®åŠ¨æ€æ‰“å°å¼‚å¸¸] {e}")

    @staticmethod
    def get_template():
        """ç›®å½•ç¾åŒ–æ¨¡æ¿"""
        return """
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>{title}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {{ margin:0; padding:0; box-sizing:border-box; font-family:Microsoft YaHei }}
        body {{ background:#f8f9fa; padding:40px }}
        .container {{ max-width:1000px; margin:0 auto; background:white; padding:30px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1) }}
        h1 {{ color:#6a5acd; margin-bottom:20px }}
        .breadcrumb {{ margin:20px 0; display:flex; gap:8px }}
        .back-btn {{ display:inline-block; padding:8px 16px; background:#6a5acd; color:white; border-radius:8px; text-decoration:none }}
        .items {{ display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:15px }}
        .item {{ display:flex; align-items:center; padding:12px; border-radius:8px; text-decoration:none; color:#495057 }}
        .folder i {{ color:#ffc107 }}
        .file i {{ color:#6a5acd }}
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“‚ ç›®å½•åˆ—è¡¨: {path}</h1>
        <div class="breadcrumb">{breadcrumb}</div>
        {back_button}
        <div class="items">{items}</div>
    </div>
</body>
</html>
        """

    def do_GET(self):
        """å¤„ç†GETè¯·æ±‚"""
        parsed = urlparse(self.path)
        path = parsed.path

        # æ£€æŸ¥æ˜¯å¦æ˜¯å—ä¿æŠ¤çš„è·¯å¾„
        if self.is_protected_path(path):
            logger.warning(f"é˜»æ­¢è®¿é—®å—ä¿æŠ¤è·¯å¾„: {path} æ¥è‡ª {self.address_string()}")
            self.send_error(403, "ç¦æ­¢è®¿é—®")
            return

        # å¤„ç†/talkè·¯å¾„ï¼Œè¿”å›é™æ€é¡µé¢
        if path == '/talk':
            self._serve_talk_static_page()
            return

        # è®¿é—®è®¡æ•°æ¥å£
        if path == '/visit-count':
            self._handle_visit_count()
            return

        # è½¬å‘APIè¯·æ±‚åˆ°Flask
        if FLASK_AVAILABLE and path.startswith('/api/'):
            self._forward_to_flask()
            return

        # é¦–é¡µé‡å®šå‘
        if path in ('', '/'):
            self.send_response(301)
            self.send_header('Location', '/home/')
            self.end_headers()
            return

        # é™æ€æ–‡ä»¶/ç›®å½•
        local = self.translate_path(self.path)
        if not self.validate_path(local):
            return
        super().do_GET()

    def do_POST(self):
        """å¤„ç†POSTè¯·æ±‚"""
        # æ£€æŸ¥æ˜¯å¦æ˜¯å—ä¿æŠ¤çš„è·¯å¾„
        if self.is_protected_path(self.path):
            logger.warning(f"é˜»æ­¢POSTè®¿é—®å—ä¿æŠ¤è·¯å¾„: {self.path} æ¥è‡ª {self.address_string()}")
            self.send_error(403, "ç¦æ­¢è®¿é—®")
            return
            
        local = self.translate_path(self.path)
        if not self.validate_path(local):
            return
        
        # è½¬å‘APIè¯·æ±‚åˆ°Flask
        if FLASK_AVAILABLE and self.path.startswith('/api/'):
            self._forward_to_flask()
            return
        super().do_POST()

    def do_DELETE(self):
        """å¤„ç†DELETEè¯·æ±‚"""
        # æ£€æŸ¥æ˜¯å¦æ˜¯å—ä¿æŠ¤çš„è·¯å¾„
        if self.is_protected_path(self.path):
            logger.warning(f"é˜»æ­¢DELETEè®¿é—®å—ä¿æŠ¤è·¯å¾„: {self.path} æ¥è‡ª {self.address_string()}")
            self.send_error(403, "ç¦æ­¢è®¿é—®")
            return
            
        local = self.translate_path(self.path)
        if not self.validate_path(local):
            return
        
        # è½¬å‘APIè¯·æ±‚åˆ°Flask
        if FLASK_AVAILABLE and self.path.startswith('/api/'):
            self._forward_to_flask()
            return
        super().do_DELETE()

    def _serve_talk_static_page(self):
        """è¿”å›ç•™è¨€æ¿é™æ€é¡µé¢"""
        talk_html_path = os.path.join(current_script_dir, 'talk', 'comment.html')
        try:
            with open(talk_html_path, 'rb') as f:
                self.send_response(200)
                self.send_header("Content-type", "text/html; charset=utf-8")
                self.end_headers()
                self.wfile.write(f.read())
        except FileNotFoundError:
            logger.error(f"ç•™è¨€æ¿é™æ€é¡µé¢ä¸å­˜åœ¨ï¼š{talk_html_path}")
            self.send_error(404, "ç•™è¨€æ¿é¡µé¢ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥talk/comment.htmlæ–‡ä»¶")
        except Exception as e:
            logger.error(f"è¯»å–ç•™è¨€æ¿é¡µé¢å¤±è´¥ï¼š{e}")
            self.send_error(500, "è¯»å–ç•™è¨€æ¿é¡µé¢å¤±è´¥")

    def _handle_visit_count(self):
        """å¤„ç†è®¿é—®è®¡æ•°è¯·æ±‚"""
        self.send_response(200)
        self.send_header("Content-type", "application/json; charset=utf-8")
        self.end_headers()
        
        # è¯»å–å®Œæ•´çš„æ•°æ®æ–‡ä»¶
        try:
            if os.path.exists(VISIT_COUNT_FILE):
                with open(VISIT_COUNT_FILE, 'r', encoding='utf-8') as f:
                    data = json.load(f)
            else:
                total = get_total_visits()
                data = {"count": total, "total_visits": total, "update_time": datetime.now().strftime("%Y-%m-%d %H:%M:%S")}
        except:
            total = get_total_visits()
            data = {"count": total, "total_visits": total, "update_time": datetime.now().strftime("%Y-%m-%d %H:%M:%S")}
        
        self.wfile.write(json.dumps({
            "code": 200, 
            "message": "success",
            "data": data
        }, ensure_ascii=False).encode('utf-8'))

    def _forward_to_flask(self):
        """è½¬å‘è¯·æ±‚åˆ°Flask"""
        if not FLASK_AVAILABLE:
            self.send_error(500, "ç•™è¨€æ¿æ¨¡å—æœªåŠ è½½")
            return
        try:
            data = b""
            if self.command in ["POST", "PUT", "DELETE"]:
                cl = int(self.headers.get("Content-Length", 0))
                if 0 < cl < Config.MAX_POST_SIZE:
                    data = self.rfile.read(cl)

            with message_board.app.test_client() as client:
                headers = dict(self.headers)
                if self.command == "GET":
                    resp = client.get(self.path, headers=headers)
                elif self.command == "DELETE":
                    resp = client.delete(self.path, headers=headers)
                else:
                    content_type = self.headers.get('Content-Type', 'application/x-www-form-urlencoded')
                    resp = client.post(self.path, data=data, headers=headers, content_type=content_type)

            self.send_response(resp.status_code)
            for k, v in resp.headers.items():
                self.send_header(k, v)
            self.end_headers()
            self.wfile.write(resp.data)
        except Exception as e:
            logger.error(f"Flaskè½¬å‘å¼‚å¸¸ï¼š{e}")
            self.send_response(500)
            self.send_header("Content-type", "text/html; charset=utf-8")
            self.end_headers()
            error_html = """
            <html>
            <head><title>500 æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</title></head>
            <body style='padding:40px'>
                <h1>500 æ¥å£è¯·æ±‚å¤„ç†å¤±è´¥</h1>
            </body>
            </html>
            """
            self.wfile.write(error_html.encode('utf-8'))

    def list_directory(self, path):
        """ç›®å½•åˆ—è¡¨ç¾åŒ–"""
        if not self.validate_path(path):
            return None
        try:
            lst = os.listdir(path)
        except OSError as e:
            logger.error(f"è¯»å–ç›®å½• {path} å¤±è´¥ï¼š{e}")
            self.send_error(404)
            return None

        lst.sort(key=lambda x: (not os.path.isdir(os.path.join(path, x)), x.lower()))
        cur = unquote(self.path)
        if not cur.endswith('/'):
            cur += '/'

        bread = []
        p = ''
        bread.append('<a href="/"><i class="fas fa-home"></i> é¦–é¡µ</a>')
        for part in cur.strip('/').split('/'):
            if part:
                p += part + '/'
                bread.append(f'<span>/</span><a href="/{p}">{part}</a>')

        back = ''
        if cur != '/':
            parent = os.path.dirname(cur.rstrip('/')).replace('\\', '/') or '/'
            back = f'<a href="{parent}" class="back-btn"><i class="fas fa-arrow-left"></i> è¿”å›ä¸Šä¸€çº§</a>'

        items = []
        for name in lst:
            fp = os.path.join(path, name)
            url = self.path + name
            if os.path.isdir(fp):
                items.append(f'''
                <a href="{url}/" class="item folder">
                    <i class="fas fa-folder"></i>
                    <div class="item-name">{name}</div>
                </a>''')
            else:
                file_ext = os.path.splitext(name)[1].lower()
                icon = 'fas fa-file'
                if file_ext in ['.html', '.htm']: icon = 'fas fa-file-html'
                elif file_ext in ['.jpg', '.jpeg', '.png']: icon = 'fas fa-file-image'
                elif file_ext in ['.mp4', '.avi']: icon = 'fas fa-file-video'
                items.append(f'''
                <a href="{url}" class="item file">
                    <i class="{icon}"></i>
                    <div class="item-name">{name}</div>
                </a>''')

        html = self.get_template().format(
            title=f"ç›®å½•åˆ—è¡¨ - {cur}",
            path=cur,
            breadcrumb=''.join(bread),
            back_button=back,
            items=''.join(items)
        )
        self.send_response(200)
        self.send_header("Content-type", "text/html; charset=utf-8")
        self.end_headers()
        self.wfile.write(html.encode('utf-8'))
        return None

# ===================== æœåŠ¡å™¨ =====================
class DualStackServer(ThreadingHTTPServer):
    def server_bind(self):
        """ç»‘å®šæœåŠ¡å™¨"""
        try:
            self.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
            self.socket.settimeout(10)
            with contextlib.suppress(Exception):
                self.socket.setsockopt(socket.IPPROTO_IPV6, socket.IPV6_V6ONLY, 0)
            super().server_bind()
            logger.info(f"âœ… æœåŠ¡å™¨ç»‘å®šæˆåŠŸï¼š{self.server_address}")
        except Exception as e:
            logger.error(f"æœåŠ¡å™¨ç»‘å®šå¼‚å¸¸ï¼š{e}")
            raise

    def finish_request(self, request, client_address):
        """å¤„ç†è¯·æ±‚"""
        try:
            request.settimeout(10)
            super().finish_request(request, client_address)
        except Exception as e:
            logger.error(f"è¯·æ±‚å¤„ç†è¶…æ—¶ {client_address}ï¼š{e}")
            with contextlib.suppress(Exception):
                request.close()

# ===================== å¯åŠ¨ =====================
def run_server():
    """å¯åŠ¨æœåŠ¡å™¨"""
    # é‡ç½®è®¿é—®è®¡æ•°
    if Config.RESET_VISITS:
        try:
            with open(VISIT_COUNT_FILE, 'w', encoding='utf-8') as f:
                json.dump({"count": 0, "total_visits": 0}, f)
            logger.info("âœ… è®¿é—®è®¡æ•°å·²é‡ç½®ä¸º0")
        except Exception as e:
            logger.error(f"é‡ç½®è®¡æ•°å¤±è´¥ï¼š{e}")

    # å¯åŠ¨æœåŠ¡å™¨
    server_dir = Config.SERVER_DIR or current_script_dir
    os.chdir(server_dir)
    handler = partial(BeautifulDirectoryHandler, directory=server_dir)
    httpd = DualStackServer((Config.HOST, Config.PORT), handler)
    httpd.timeout = 10
    httpd.daemon_threads = True

    local_ip = socket.gethostbyname(socket.gethostname())
    logger.info("\nğŸš€ æœåŠ¡å¯åŠ¨æˆåŠŸï¼")
    logger.info(f"â”œâ”€ æœ¬åœ°è®¿é—®: http://localhost:{Config.PORT}")
    logger.info(f"â”œâ”€ å¤–ç½‘è®¿é—®: http://{local_ip}:{Config.PORT}")
    logger.info(f"â”œâ”€ ç•™è¨€æ¿: http://localhost:{Config.PORT}/talk")
    logger.info(f"â”œâ”€ è®¡æ•°æŸ¥è¯¢: http://localhost:{Config.PORT}/visit-count")
    logger.info(f"â”œâ”€ æ•°æ®ç›®å½•ä¿æŠ¤: å·²å¯ç”¨")
    logger.info(f"â””â”€ æ ¹ç›®å½•: {os.path.abspath(server_dir)}")

    try:
        httpd.serve_forever()
    except KeyboardInterrupt:
        logger.info("\nğŸ›‘ æœåŠ¡æ­£åœ¨åœæ­¢...")
        httpd.server_close()
        logger.info("âœ… æœåŠ¡å·²åœæ­¢")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="ä¸ªäººVlog HTTPæœåŠ¡ç«¯")
    parser.add_argument("-p", "--port", type=int, default=8000, help="ç›‘å¬ç«¯å£")
    parser.add_argument("-H", "--host", type=str, default="0.0.0.0", help="ç›‘å¬åœ°å€")
    parser.add_argument("--reset-visits", action="store_true", help="é‡ç½®è®¿é—®æ¬¡æ•°")
    args = parser.parse_args()
    
    Config.PORT = args.port
    Config.HOST = args.host
    Config.RESET_VISITS = args.reset_visits 
    
    run_server()
```

---

## File: src\auth.py

```py
# -*- coding: utf-8 -*-
"""
ç”¨æˆ·è®¤è¯æ¨¡å—ï¼ˆå¸¦å¯†ç åŠ å¯†ï¼‰
"""
import json
import os
import time
import uuid
import hashlib
import secrets
from datetime import datetime

# æ•°æ®æ–‡ä»¶è·¯å¾„
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
USERS_FILE = os.path.join(BASE_DIR, "data", "users.json")
SESSIONS_FILE = os.path.join(BASE_DIR, "data", "sessions.json")

# åˆå§‹åŒ–æ•°æ®æ–‡ä»¶
def init_files():
    """ç¡®ä¿æ•°æ®æ–‡ä»¶å­˜åœ¨"""
    os.makedirs(os.path.dirname(USERS_FILE), exist_ok=True)
    
    if not os.path.exists(USERS_FILE):
        with open(USERS_FILE, "w", encoding="utf-8") as f:
            json.dump({}, f, ensure_ascii=False, indent=2)
    if not os.path.exists(SESSIONS_FILE):
        with open(SESSIONS_FILE, "w", encoding="utf-8") as f:
            json.dump({}, f, ensure_ascii=False, indent=2)

# ==================== å¯†ç åŠ å¯†å‡½æ•° ====================

def hash_password(password):
    """
    å¯†ç åŠ å¯†
    ä½¿ç”¨ç›å€¼+SHA256åŠ å¯†
    """
    # ç”Ÿæˆéšæœºç›å€¼ï¼ˆ16å­—èŠ‚=32ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼‰
    salt = secrets.token_hex(16)
    # ä½¿ç”¨SHA-256åŠ å¯†
    hash_obj = hashlib.sha256((password + salt).encode('utf-8'))
    # è¿”å› ç›å€¼$å“ˆå¸Œå€¼ æ ¼å¼
    return f"{salt}${hash_obj.hexdigest()}"

def verify_password(password, hashed_password):
    """
    éªŒè¯å¯†ç 
    hashed_passwordæ ¼å¼: ç›å€¼$å“ˆå¸Œå€¼
    """
    try:
        salt, hash_value = hashed_password.split('$')
        hash_obj = hashlib.sha256((password + salt).encode('utf-8'))
        return hash_obj.hexdigest() == hash_value
    except:
        return False

# ==================== ä¼šè¯ç®¡ç†å‡½æ•° ====================

def create_session(email):
    """åˆ›å»ºç”¨æˆ·ä¼šè¯"""
    init_files()
    
    # ç”Ÿæˆsession_id
    session_id = str(uuid.uuid4())
    expire_time = time.time() + 30*24*60*60  # 30å¤©è¿‡æœŸ
    
    # å­˜å‚¨ä¼šè¯
    with open(SESSIONS_FILE, "r", encoding="utf-8") as f:
        sessions = json.load(f)
    
    sessions[session_id] = {
        "email": email,
        "login_time": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
        "expire_time": expire_time
    }
    
    with open(SESSIONS_FILE, "w", encoding="utf-8") as f:
        json.dump(sessions, f, ensure_ascii=False, indent=2)
    
    print(f"åˆ›å»ºä¼šè¯: {session_id} for {email}")
    return session_id

def check_login_status(session_id):
    """æ£€æŸ¥ç™»å½•çŠ¶æ€"""
    print(f"check_login_status è¢«è°ƒç”¨, session_id: '{session_id}'")
    
    if not session_id:
        print("session_id ä¸ºç©º")
        return False
    
    init_files()
    try:
        with open(SESSIONS_FILE, "r", encoding="utf-8") as f:
            sessions = json.load(f)
        
        if session_id not in sessions:
            print(f"session_id {session_id} ä¸å­˜åœ¨")
            return False
        
        # æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        if time.time() > sessions[session_id]["expire_time"]:
            print(f"session_id {session_id} å·²è¿‡æœŸ")
            del sessions[session_id]
            with open(SESSIONS_FILE, "w", encoding="utf-8") as f:
                json.dump(sessions, f, ensure_ascii=False, indent=2)
            return False
        
        print(f"session_id {session_id} æœ‰æ•ˆ")
        return True
    except Exception as e:
        print(f"æ£€æŸ¥ç™»å½•çŠ¶æ€å‡ºé”™: {e}")
        return False

def get_current_user(session_id):
    """è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯"""
    if not session_id:
        return {}
    
    init_files()
    with open(SESSIONS_FILE, "r", encoding="utf-8") as f:
        sessions = json.load(f)
    
    if session_id not in sessions:
        return {}
    
    # æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
    if time.time() > sessions[session_id]["expire_time"]:
        del sessions[session_id]
        with open(SESSIONS_FILE, "w", encoding="utf-8") as f:
            json.dump(sessions, f, ensure_ascii=False, indent=2)
        return {}
    
    email = sessions[session_id]["email"]
    
    # è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
    with open(USERS_FILE, "r", encoding="utf-8") as f:
        users = json.load(f)
    
    if email not in users:
        return {}
    
    user = users[email]
    return {
        "username": user.get("username", ""),
        "email": email
    }

def logout_user(session_id):
    """é€€å‡ºç™»å½•"""
    if not session_id:
        return False
    
    init_files()
    with open(SESSIONS_FILE, "r", encoding="utf-8") as f:
        sessions = json.load(f)
    
    if session_id in sessions:
        del sessions[session_id]
        with open(SESSIONS_FILE, "w", encoding="utf-8") as f:
            json.dump(sessions, f, ensure_ascii=False, indent=2)
        return True
    
    return False

# ç”¨æˆ·æ³¨å†Œï¼ˆä½¿ç”¨åŠ å¯†å¯†ç ï¼‰
def register(username, email, password):
    """ç”¨æˆ·æ³¨å†Œï¼ˆå¯†ç åŠ å¯†å­˜å‚¨ï¼‰"""
    init_files()
    with open(USERS_FILE, "r", encoding="utf-8") as f:
        users = json.load(f)
    
    if email in users:
        return {"code": 1, "msg": "é‚®ç®±å·²å­˜åœ¨"}
    
    # åŠ å¯†å¯†ç å¹¶å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
    users[email] = {
        "username": username,
        "password": hash_password(password),  # åŠ å¯†å­˜å‚¨
        "email": email,
        "create_time": time.time(),
        "create_time_str": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    }
    
    with open(USERS_FILE, "w", encoding="utf-8") as f:
        json.dump(users, f, ensure_ascii=False, indent=2)
    
    return {"code": 0, "msg": "æ³¨å†ŒæˆåŠŸ"}

# å¯†ç ç™»å½•ï¼ˆéªŒè¯åŠ å¯†å¯†ç ï¼‰
def login(email, password):
    """å¯†ç ç™»å½•ï¼ˆéªŒè¯åŠ å¯†å¯†ç ï¼‰"""
    init_files()
    with open(USERS_FILE, "r", encoding="utf-8") as f:
        users = json.load(f)
    
    if email not in users:
        return {"code": 1, "msg": "é‚®ç®±æˆ–å¯†ç é”™è¯¯"}
    
    # éªŒè¯å¯†ç 
    if not verify_password(password, users[email]["password"]):
        return {"code": 1, "msg": "é‚®ç®±æˆ–å¯†ç é”™è¯¯"}
    
    # åˆ›å»ºä¼šè¯
    session_id = create_session(email)
    
    return {
        "code": 0, 
        "msg": "ç™»å½•æˆåŠŸ", 
        "data": {
            "session_id": session_id, 
            "username": users[email]["username"],
            "email": email
        }
    }


if __name__ == "__main__":
    # æµ‹è¯•ä»£ç 
    init_files()
    print(register("test", "test@qq.com", "123456"))
    print(login("test@qq.com", "123456"))
```

---

## File: src\message_board.py

```py
# -*- coding: utf-8 -*-
"""
Flaskç•™è¨€æ¿&ç”¨æˆ·è®¤è¯æ ¸å¿ƒæ¨¡å—
"""
import os
import json
import time
import logging
import random
import string
from flask import Flask, request, jsonify, make_response
from email.mime.text import MIMEText
from email.utils import formataddr

# ===================== å…ˆåˆå§‹åŒ–æ—¥å¿— =====================
logger = logging.getLogger("message_board")
if not logger.handlers:
    logger.setLevel(logging.INFO)
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(logging.Formatter("%(asctime)s - %(levelname)s - %(message)s"))
    logger.addHandler(console_handler)

# ===================== åŸºç¡€é…ç½® =====================
app = Flask(__name__)
app.config["JSON_AS_ASCII"] = False
app.config["SECRET_KEY"] = "personal_vlog_2026_key"

# é¡¹ç›®è·¯å¾„é…ç½®
ROOT_DIR = os.path.abspath(os.path.join(os.path.dirname(__file__), ".."))
DATA_DIR = os.path.join(ROOT_DIR, "data")
USER_FILE = os.path.join(DATA_DIR, "users.json")
MESSAGES_FILE = os.path.join(DATA_DIR, "messages.json")
VERIFY_CACHE = {}  # éªŒè¯ç ç¼“å­˜

# ç¡®ä¿æ•°æ®ç›®å½•å­˜åœ¨
os.makedirs(DATA_DIR, exist_ok=True)

# ===================== å¯¼å…¥è®¤è¯æ¨¡å—ï¼ˆåŒ…å«åŠ å¯†å‡½æ•°ï¼‰ =====================
try:
    from src.auth import (
        create_session,
        check_login_status,
        get_current_user,
        logout_user,
        hash_password,  # å¯¼å…¥åŠ å¯†å‡½æ•°
        verify_password  # å¯¼å…¥éªŒè¯å‡½æ•°
    )
    logger.info("âœ… authæ¨¡å—å¯¼å…¥æˆåŠŸ")
except ImportError as e:
    logger.error(f"å¯¼å…¥authæ¨¡å—å¤±è´¥ï¼š{e}")
    # ç®€æ˜“ç‰ˆè®¤è¯å‡½æ•°
    def create_session(email):
        session_id = f"session_{int(time.time())}_{email}"
        return session_id
    
    def check_login_status(session_id):
        return bool(session_id and session_id.startswith("session_"))
    
    def get_current_user(session_id):
        if session_id and session_id.startswith("session_"):
            return {"username": "æµ‹è¯•ç”¨æˆ·", "email": session_id.split("_")[-1]}
        return {}
    
    def logout_user(session_id):
        return True
    
    # ç®€æ˜“åŠ å¯†å‡½æ•°ï¼ˆå®é™…ä½¿ç”¨æ—¶åº”ä»authå¯¼å…¥ï¼‰
    import hashlib
    import secrets
    def hash_password(password):
        salt = secrets.token_hex(16)
        hash_obj = hashlib.sha256((password + salt).encode('utf-8'))
        return f"{salt}${hash_obj.hexdigest()}"
    
    def verify_password(password, hashed_password):
        try:
            salt, hash_value = hashed_password.split('$')
            hash_obj = hashlib.sha256((password + salt).encode('utf-8'))
            return hash_obj.hexdigest() == hash_value
        except:
            return False

# ===================== å¯¼å…¥é‚®ä»¶æ¨¡å— =====================
try:
    from src.qqmail import send_verify_code, generate_code
    logger.info("âœ… ä»src.qqmailå¯¼å…¥é‚®ä»¶æ¨¡å—æˆåŠŸ")
except ImportError:
    try:
        from qqmail import send_verify_code, generate_code
        logger.info("âœ… ä»qqmailå¯¼å…¥é‚®ä»¶æ¨¡å—æˆåŠŸ")
    except ImportError as e:
        logger.warning(f"å¯¼å…¥é‚®ä»¶æ¨¡å—å¤±è´¥ï¼š{e}ï¼Œä½¿ç”¨å†…ç½®å‡½æ•°")
        def generate_code(length=6):
            return ''.join(random.choices(string.digits, k=length))
        
        def send_verify_code(to_email, code=None):
            if code is None:
                code = generate_code()
            logger.info(f"[æ¨¡æ‹Ÿå‘é€] éªŒè¯ç  {code} å‘é€è‡³ {to_email}")
            return True, "éªŒè¯ç å‘é€æˆåŠŸï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰", code

# ===================== å·¥å…·å‡½æ•° =====================
def load_users():
    """åŠ è½½ç”¨æˆ·æ•°æ®"""
    try:
        if not os.path.exists(USER_FILE):
            return {}
        with open(USER_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    except Exception as e:
        logger.error(f"åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥ï¼š{e}")
        return {}

def save_users(users):
    """ä¿å­˜ç”¨æˆ·æ•°æ®"""
    try:
        with open(USER_FILE, "w", encoding="utf-8") as f:
            json.dump(users, f, ensure_ascii=False, indent=2)
        return True
    except Exception as e:
        logger.error(f"ä¿å­˜ç”¨æˆ·æ•°æ®å¤±è´¥ï¼š{e}")
        return False

def load_messages():
    """åŠ è½½ç•™è¨€æ•°æ®"""
    try:
        if not os.path.exists(MESSAGES_FILE):
            return []
        with open(MESSAGES_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    except Exception as e:
        logger.error(f"åŠ è½½ç•™è¨€æ•°æ®å¤±è´¥ï¼š{e}")
        return []

def save_messages(messages):
    """ä¿å­˜ç•™è¨€æ•°æ®"""
    try:
        with open(MESSAGES_FILE, "w", encoding="utf-8") as f:
            json.dump(messages, f, ensure_ascii=False, indent=2)
        return True
    except Exception as e:
        logger.error(f"ä¿å­˜ç•™è¨€æ•°æ®å¤±è´¥ï¼š{e}")
        return False

def get_session_id_from_request():
    """ä»è¯·æ±‚ä¸­è·å–session_idï¼ˆæ”¯æŒcookieå’Œheaderï¼‰"""
    # 1. ä»cookieè·å–
    session_id = request.cookies.get('session_id', '')
    if session_id:
        print(f"ä»cookieè·å–session_id: {session_id}")
        return session_id
    
    # 2. ä»Authorization headerè·å–
    auth_header = request.headers.get('Authorization', '')
    if auth_header.startswith('Session '):
        session_id = auth_header[8:].strip()
        print(f"ä»headerè·å–session_id: {session_id}")
        return session_id
    
    # 3. ä»è¯·æ±‚å‚æ•°è·å–
    session_id = request.args.get('session_id', '') or request.form.get('session_id', '')
    if session_id:
        print(f"ä»å‚æ•°è·å–session_id: {session_id}")
        return session_id
    
    # 4. ä»JSON bodyè·å–
    if request.is_json:
        data = request.get_json(silent=True) or {}
        session_id = data.get('session_id', '')
        if session_id:
            print(f"ä»JSONè·å–session_id: {session_id}")
            return session_id
    
    return ''

# ===================== æ³¨å†Œæ¥å£ =====================
@app.route("/api/register/send-code", methods=["POST"])
def send_register_code():
    """å‘é€æ³¨å†ŒéªŒè¯ç """
    try:
        data = request.get_json(silent=True) or {}
        email = data.get("email", "").strip()
        
        if not email or "@" not in email:
            return jsonify({"code": 400, "msg": "è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€"})
        
        # æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²æ³¨å†Œ
        users = load_users()
        if email in users:
            return jsonify({"code": 400, "msg": "è¯¥é‚®ç®±å·²æ³¨å†Œï¼Œè¯·ç›´æ¥ç™»å½•"})
        
        # æ£€æŸ¥æ˜¯å¦é¢‘ç¹å‘é€
        if email in VERIFY_CACHE:
            cache = VERIFY_CACHE[email]
            if cache["expire"] > time.time() + 240:
                return jsonify({"code": 400, "msg": "éªŒè¯ç å·²å‘é€ï¼Œè¯·5åˆ†é’Ÿåé‡è¯•"})
        
        # å‘é€éªŒè¯ç 
        success, msg, code = send_verify_code(email)
        
        if success:
            # ä¿å­˜éªŒè¯ç 
            VERIFY_CACHE[email] = {
                "code": code,
                "expire": time.time() + 300,
                "type": "register"
            }
            logger.info(f"æ³¨å†ŒéªŒè¯ç å‘é€æˆåŠŸï¼š{email}")
            return jsonify({"code": 200, "msg": "éªŒè¯ç å‘é€æˆåŠŸï¼Œè¯·æŸ¥æ”¶é‚®ç®±"})
        else:
            logger.error(f"æ³¨å†ŒéªŒè¯ç å‘é€å¤±è´¥ï¼š{email} - {msg}")
            return jsonify({"code": 500, "msg": msg})
            
    except Exception as e:
        logger.error(f"å‘é€æ³¨å†ŒéªŒè¯ç å¼‚å¸¸ï¼š{e}", exc_info=True)
        return jsonify({"code": 500, "msg": f"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼š{str(e)}"})

@app.route("/api/register", methods=["POST"])
def register():
    """ç”¨æˆ·æ³¨å†Œï¼ˆå¯†ç åŠ å¯†å­˜å‚¨ï¼‰"""
    try:
        data = request.get_json(silent=True) or {}
        username = data.get("username", "").strip()
        email = data.get("email", "").strip()
        password = data.get("password", "").strip()
        code = data.get("code", "").strip()
        
        if not all([username, email, password, code]):
            return jsonify({"code": 400, "msg": "è¯·å¡«å†™å®Œæ•´æ³¨å†Œä¿¡æ¯"})
        
        if len(username) < 2 or len(username) > 20:
            return jsonify({"code": 400, "msg": "ç”¨æˆ·åé•¿åº¦ä¸º2-20ä¸ªå­—ç¬¦"})
        
        if len(password) < 6:
            return jsonify({"code": 400, "msg": "å¯†ç é•¿åº¦è‡³å°‘6ä½"})
        
        # æ ¡éªŒéªŒè¯ç 
        if email not in VERIFY_CACHE:
            return jsonify({"code": 400, "msg": "éªŒè¯ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°è·å–"})
        
        cache = VERIFY_CACHE[email]
        if cache["type"] != "register" or cache["code"] != code:
            return jsonify({"code": 400, "msg": "éªŒè¯ç é”™è¯¯"})
        
        if time.time() > cache["expire"]:
            del VERIFY_CACHE[email]
            return jsonify({"code": 400, "msg": "éªŒè¯ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°è·å–"})
        
        # æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²æ³¨å†Œ
        users = load_users()
        if email in users:
            return jsonify({"code": 400, "msg": "è¯¥é‚®ç®±å·²æ³¨å†Œ"})
        
        # åŠ å¯†å¯†ç 
        encrypted_password = hash_password(password)
        logger.info(f"å¯†ç åŠ å¯†æˆåŠŸ: {password} -> {encrypted_password[:20]}...")
        
        # ä¿å­˜ç”¨æˆ·ï¼ˆä½¿ç”¨åŠ å¯†åçš„å¯†ç ï¼‰
        users[email] = {
            "username": username,
            "password": encrypted_password,  # å­˜å‚¨åŠ å¯†åçš„å¯†ç 
            "email": email,
            "create_time": time.time(),
            "create_time_str": time.strftime("%Y-%m-%d %H:%M:%S")
        }
        
        if save_users(users):
            del VERIFY_CACHE[email]
            logger.info(f"ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼š{username}({email})")
            return jsonify({"code": 200, "msg": "æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•"})
        else:
            return jsonify({"code": 500, "msg": "ä¿å­˜ç”¨æˆ·ä¿¡æ¯å¤±è´¥"})
            
    except Exception as e:
        logger.error(f"æ³¨å†Œå¼‚å¸¸ï¼š{e}", exc_info=True)
        return jsonify({"code": 500, "msg": f"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼š{str(e)}"})

# ===================== ç™»å½•æ¥å£ =====================
@app.route("/api/login/send-code", methods=["POST"])
def send_login_code():
    """å‘é€ç™»å½•éªŒè¯ç """
    try:
        data = request.get_json(silent=True) or {}
        email = data.get("email", "").strip()
        
        if not email or "@" not in email:
            return jsonify({"code": 400, "msg": "è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€"})
        
        # æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²æ³¨å†Œ
        users = load_users()
        if email not in users:
            return jsonify({"code": 400, "msg": "è¯¥é‚®ç®±æœªæ³¨å†Œï¼Œè¯·å…ˆæ³¨å†Œ"})
        
        # å‘é€éªŒè¯ç 
        success, msg, code = send_verify_code(email)
        
        if success:
            VERIFY_CACHE[email] = {
                "code": code,
                "expire": time.time() + 300,
                "type": "login"
            }
            return jsonify({"code": 200, "msg": "éªŒè¯ç å‘é€æˆåŠŸï¼Œè¯·æŸ¥æ”¶é‚®ç®±"})
        else:
            return jsonify({"code": 500, "msg": msg})
            
    except Exception as e:
        logger.error(f"å‘é€ç™»å½•éªŒè¯ç å¼‚å¸¸ï¼š{e}", exc_info=True)
        return jsonify({"code": 500, "msg": f"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼š{str(e)}"})

@app.route("/api/login/code", methods=["POST"])
def login_by_code():
    """éªŒè¯ç ç™»å½•"""
    try:
        data = request.get_json(silent=True) or {}
        email = data.get("email", "").strip()
        code = data.get("code", "").strip()
        
        if not email or not code:
            return jsonify({"code": 400, "msg": "è¯·è¾“å…¥é‚®ç®±å’ŒéªŒè¯ç "})
        
        # æ ¡éªŒéªŒè¯ç 
        if email not in VERIFY_CACHE:
            return jsonify({"code": 400, "msg": "éªŒè¯ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°è·å–"})
        
        cache = VERIFY_CACHE[email]
        if cache["type"] != "login" or cache["code"] != code:
            return jsonify({"code": 400, "msg": "éªŒè¯ç é”™è¯¯"})
        
        if time.time() > cache["expire"]:
            del VERIFY_CACHE[email]
            return jsonify({"code": 400, "msg": "éªŒè¯ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°è·å–"})
        
        # è·å–ç”¨æˆ·ä¿¡æ¯
        users = load_users()
        if email not in users:
            return jsonify({"code": 400, "msg": "ç”¨æˆ·ä¸å­˜åœ¨"})
        
        user = users[email]
        
        # åˆ›å»ºä¼šè¯
        session_id = create_session(email)
        
        # åˆ é™¤éªŒè¯ç 
        del VERIFY_CACHE[email]
        
        # åˆ›å»ºå“åº”
        response = make_response(jsonify({
            "code": 200,
            "msg": "ç™»å½•æˆåŠŸ",
            "data": {
                "username": user["username"],
                "email": email,
                "session_id": session_id
            }
        }))
        
        # è®¾ç½®cookie
        response.set_cookie(
            'session_id',
            session_id,
            max_age=30*24*60*60,  # 30å¤©
            path='/'
        )
        
        print(f"éªŒè¯ç ç™»å½•æˆåŠŸï¼Œè®¾ç½®cookie: session_id={session_id}")
        logger.info(f"ç”¨æˆ·éªŒè¯ç ç™»å½•æˆåŠŸï¼š{user['username']}({email})")
        return response
        
    except Exception as e:
        print(f"éªŒè¯ç ç™»å½•å¼‚å¸¸ï¼š{e}")
        logger.error(f"éªŒè¯ç ç™»å½•å¼‚å¸¸ï¼š{e}", exc_info=True)
        return jsonify({"code": 500, "msg": f"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼š{str(e)}"})

@app.route("/api/login/password", methods=["POST"])
def login_by_password():
    """å¯†ç ç™»å½•ï¼ˆéªŒè¯åŠ å¯†å¯†ç ï¼‰"""
    try:
        data = request.get_json(silent=True) or {}
        email = data.get("email", "").strip()
        password = data.get("password", "").strip()
        
        if not email or not password:
            return jsonify({"code": 400, "msg": "è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç "})
        
        # éªŒè¯ç”¨æˆ·
        users = load_users()
        if email not in users:
            return jsonify({"code": 400, "msg": "é‚®ç®±æˆ–å¯†ç é”™è¯¯"})
        
        user = users[email]
        
        # éªŒè¯åŠ å¯†å¯†ç 
        if not verify_password(password, user["password"]):
            logger.warning(f"å¯†ç éªŒè¯å¤±è´¥: {email}")
            return jsonify({"code": 400, "msg": "é‚®ç®±æˆ–å¯†ç é”™è¯¯"})
        
        # åˆ›å»ºä¼šè¯
        session_id = create_session(email)
        
        # åˆ›å»ºå“åº”
        response = make_response(jsonify({
            "code": 200,
            "msg": "ç™»å½•æˆåŠŸ",
            "data": {
                "username": user["username"],
                "email": email,
                "session_id": session_id
            }
        }))
        
        # è®¾ç½®cookie
        response.set_cookie(
            'session_id',
            session_id,
            max_age=30*24*60*60,  # 30å¤©
            path='/'
        )
        
        print(f"å¯†ç ç™»å½•æˆåŠŸï¼Œè®¾ç½®cookie: session_id={session_id}")
        logger.info(f"ç”¨æˆ·å¯†ç ç™»å½•æˆåŠŸï¼š{user['username']}({email})")
        return response
        
    except Exception as e:
        print(f"å¯†ç ç™»å½•å¼‚å¸¸ï¼š{e}")
        logger.error(f"å¯†ç ç™»å½•å¼‚å¸¸ï¼š{e}", exc_info=True)
        return jsonify({"code": 500, "msg": f"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼š{str(e)}"})

# ===================== çŠ¶æ€æ¥å£ =====================
@app.route("/api/check-login", methods=["POST", "GET"])
def check_login():
    """æ£€æŸ¥ç™»å½•çŠ¶æ€"""
    try:
        # è·å–session_id
        session_id = get_session_id_from_request()
        
        is_login = check_login_status(session_id)
        user = get_current_user(session_id) if is_login else {}
        
        print(f"ç™»å½•çŠ¶æ€ç»“æœ - is_login: {is_login}, user: {user}")
        
        return jsonify({
            "isLogin": is_login,
            "user": user
        })
    except Exception as e:
        print(f"æ£€æŸ¥ç™»å½•çŠ¶æ€å¼‚å¸¸: {e}")
        logger.error(f"æ£€æŸ¥ç™»å½•çŠ¶æ€å¼‚å¸¸ï¼š{e}")
        return jsonify({"isLogin": False, "user": {}})

@app.route("/api/logout", methods=["POST"])
def logout():
    """é€€å‡ºç™»å½•"""
    try:
        # è·å–session_id
        session_id = get_session_id_from_request()
        print(f"ç™»å‡º - session_id: '{session_id}'")
        
        if session_id and logout_user(session_id):
            response = make_response(jsonify({
                "code": 200, 
                "msg": "é€€å‡ºç™»å½•æˆåŠŸ"
            }))
            # æ¸…é™¤cookie
            response.set_cookie('session_id', '', expires=0, path='/')
            print("ç™»å‡ºæˆåŠŸï¼Œå·²æ¸…é™¤cookie")
            return response
        else:
            print("ç™»å‡ºå¤±è´¥ï¼šsession_idæ— æ•ˆæˆ–ä¸å­˜åœ¨")
            return jsonify({"code": 400, "msg": "é€€å‡ºå¤±è´¥"})
            
    except Exception as e:
        print(f"é€€å‡ºç™»å½•å¼‚å¸¸ï¼š{e}")
        logger.error(f"é€€å‡ºç™»å½•å¼‚å¸¸ï¼š{e}")
        return jsonify({"code": 500, "msg": "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"})

# ===================== ç•™è¨€æ¿æ¥å£ =====================
@app.route("/api/talk/list", methods=["GET"])
def get_message_list():
    """è·å–ç•™è¨€åˆ—è¡¨"""
    try:
        messages = load_messages()
        # æŒ‰æ—¶é—´å€’åºæ’åˆ—
        messages.sort(key=lambda x: x.get("create_time", 0), reverse=True)
        return jsonify({"code": 200, "msg": "è·å–æˆåŠŸ", "data": messages})
    except Exception as e:
        logger.error(f"è·å–ç•™è¨€åˆ—è¡¨å¼‚å¸¸ï¼š{e}")
        return jsonify({"code": 500, "msg": "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"})

@app.route("/api/talk/add", methods=["POST"])
def add_message():
    """æ·»åŠ ç•™è¨€"""
    try:
        # è·å–session_id
        session_id = get_session_id_from_request()
        print(f"æ·»åŠ ç•™è¨€ - session_id: '{session_id}'")
        
        # æ£€æŸ¥ç™»å½•çŠ¶æ€
        if not session_id:
            return jsonify({"code": 401, "msg": "è¯·å…ˆç™»å½•"})
        
        is_login = check_login_status(session_id)
        if not is_login:
            return jsonify({"code": 401, "msg": "ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"})
        
        # è·å–ç”¨æˆ·ä¿¡æ¯
        user = get_current_user(session_id)
        if not user:
            return jsonify({"code": 401, "msg": "ç”¨æˆ·ä¿¡æ¯ä¸å­˜åœ¨"})
        
        # è·å–ç•™è¨€å†…å®¹
        data = request.get_json(silent=True) or {}
        content = data.get("content", "").strip()
        
        if not content:
            return jsonify({"code": 400, "msg": "ç•™è¨€å†…å®¹ä¸èƒ½ä¸ºç©º"})
        
        # åŠ è½½ç°æœ‰ç•™è¨€
        messages = load_messages()
        
        # åˆ›å»ºæ–°ç•™è¨€
        message = {
            "id": str(int(time.time() * 1000)) + str(random.randint(100, 999)),
            "username": user.get("username", "åŒ¿åç”¨æˆ·"),
            "content": content,
            "create_time": time.time(),
            "create_time_str": time.strftime("%Y-%m-%d %H:%M:%S")
        }
        
        # æ·»åŠ ç•™è¨€
        messages.append(message)
        
        # ä¿å­˜ç•™è¨€
        if save_messages(messages):
            logger.info(f"ç”¨æˆ·{user.get('username')}æ·»åŠ ç•™è¨€æˆåŠŸ")
            return jsonify({"code": 200, "msg": "ç•™è¨€æˆåŠŸ"})
        else:
            return jsonify({"code": 500, "msg": "ä¿å­˜ç•™è¨€å¤±è´¥"})
        
    except Exception as e:
        logger.error(f"æ·»åŠ ç•™è¨€å¼‚å¸¸ï¼š{e}")
        return jsonify({"code": 500, "msg": f"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼š{str(e)}"})

# ===================== å¯åŠ¨æœåŠ¡ =====================
if __name__ == "__main__":
    app.run(host="127.0.0.1", port=8001, debug=True)
```

---

## File: src\qqmail.py

```py
# -*- coding: utf-8 -*-
"""
QQé‚®ç®±éªŒè¯ç å‘é€æ¨¡å—ï¼ˆå®Œæ•´å¯¼å‡ºç‰ˆï¼‰
"""
import smtplib
import logging
import random
import string
from email.mime.text import MIMEText
from email.utils import formataddr

# ===================== é…ç½® =====================
QQ_MAIL_USER = "2361542526@qq.com"       # ä½ çš„QQé‚®ç®±
QQ_MAIL_AUTH_CODE = "omelrirsldmsdhha"   # QQé‚®ç®±SMTPæˆæƒç 
SMTP_SERVER = "smtp.qq.com"
SMTP_PORT = 465                          # SSLç«¯å£

# ===================== æ—¥å¿— =====================
logger = logging.getLogger("qqmail")
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')

# ===================== éªŒè¯ç ç”Ÿæˆ =====================
def generate_code(length=6):
    """ç”Ÿæˆ6ä½æ•°å­—éªŒè¯ç """
    return ''.join(random.choices(string.digits, k=length))

# ===================== æ ¸å¿ƒå‡½æ•° =====================
def send_verify_code(to_email, code=None):
    """
    å‘é€éªŒè¯ç åˆ°æŒ‡å®šé‚®ç®±ï¼ˆä½¿ç”¨SSLè¿æ¥ï¼‰
    è¿”å›ï¼š(success, message, code)
    """
    if not to_email or '@' not in to_email:
        return False, "é‚®ç®±åœ°å€æ— æ•ˆ", None
    
    # å¦‚æœæ²¡æœ‰æä¾›éªŒè¯ç ï¼Œè‡ªåŠ¨ç”Ÿæˆ
    if code is None:
        code = generate_code()
    
    # é‚®ä»¶å†…å®¹
    mail_title = "hyperçš„åšå®¢éªŒè¯ç "
    content = f"""
æ‚¨çš„éªŒè¯ç æ˜¯ï¼š{code}

éªŒè¯ç æœ‰æ•ˆæœŸä¸º5åˆ†é’Ÿï¼Œè¯·å‹¿æ³„éœ²ç»™ä»–äººã€‚
å¦‚éæœ¬äººæ“ä½œï¼Œè¯·å¿½ç•¥æ­¤é‚®ä»¶ã€‚

(æ­¤é‚®ä»¶ç”±ç³»ç»Ÿè‡ªåŠ¨å‘é€ï¼Œè¯·å‹¿å›å¤)
    """
    
    try:
        # åˆ›å»ºé‚®ä»¶
        msg = MIMEText(content, "plain", "utf-8")
        msg["From"] = formataddr(("hyperçš„åšå®¢", QQ_MAIL_USER))
        msg["To"] = to_email
        msg["Subject"] = mail_title
        
        # ä½¿ç”¨SSLè¿æ¥ï¼ˆ465ç«¯å£ï¼‰- åˆšæ‰æµ‹è¯•æˆåŠŸçš„
        logger.info(f"æ­£åœ¨è¿æ¥QQé‚®ç®±æœåŠ¡å™¨ {SMTP_SERVER}:{SMTP_PORT}...")
        server = smtplib.SMTP_SSL(SMTP_SERVER, SMTP_PORT, timeout=30)
        
        # ç™»å½•
        logger.info("æ­£åœ¨ç™»å½•...")
        server.login(QQ_MAIL_USER, QQ_MAIL_AUTH_CODE)
        
        # å‘é€
        logger.info(f"æ­£åœ¨å‘é€é‚®ä»¶åˆ° {to_email}...")
        server.sendmail(QQ_MAIL_USER, [to_email], msg.as_string())
        
        # å…³é—­è¿æ¥
        server.quit()
        
        logger.info(f"âœ… éªŒè¯ç  {code} å‘é€è‡³ {to_email} æˆåŠŸ")
        return True, "éªŒè¯ç å‘é€æˆåŠŸï¼Œè¯·æŸ¥æ”¶é‚®ç®±", code
        
    except smtplib.SMTPAuthenticationError as e:
        logger.error(f"SMTPè®¤è¯å¤±è´¥ï¼š{e}")
        return False, "é‚®ç®±æˆæƒç é”™è¯¯ï¼Œè¯·æ£€æŸ¥é…ç½®", None
    except smtplib.SMTPConnectError as e:
        logger.error(f"SMTPè¿æ¥å¤±è´¥ï¼š{e}")
        return False, "æ— æ³•è¿æ¥é‚®ç®±æœåŠ¡å™¨ï¼Œè¯·ç¨åé‡è¯•", None
    except smtplib.SMTPServerDisconnected as e:
        logger.error(f"æœåŠ¡å™¨æ–­å¼€è¿æ¥ï¼š{e}")
        return False, "æœåŠ¡å™¨è¿æ¥æ–­å¼€ï¼Œè¯·ç¨åé‡è¯•", None
    except Exception as e:
        logger.error(f"å‘é€éªŒè¯ç å¼‚å¸¸ï¼š{e}", exc_info=True)
        return False, f"å‘é€å¤±è´¥ï¼š{str(e)}", None

# ===================== æ˜ç¡®å¯¼å‡ºå‡½æ•° =====================
__all__ = ['send_verify_code', 'generate_code', 'send_verification_code']

# å…¼å®¹æ—§å‡½æ•°å
send_verification_code = send_verify_code

# æµ‹è¯•ä»£ç ï¼ˆå½“ç›´æ¥è¿è¡Œæ­¤æ–‡ä»¶æ—¶ï¼‰
if __name__ == "__main__":
    test_email = input("è¯·è¾“å…¥æµ‹è¯•é‚®ç®±ï¼š").strip()
    if test_email:
        success, msg, code = send_verify_code(test_email)
        print(f"å‘é€ç»“æœï¼š{success}")
        print(f"æ¶ˆæ¯ï¼š{msg}")
        print(f"éªŒè¯ç ï¼š{code}")
```

---

## File: src\test_email.py

```py
# -*- coding: utf-8 -*-
"""
å•ç‹¬æµ‹è¯•é‚®ä»¶å‘é€åŠŸèƒ½ï¼ˆä¿®å¤ç‰ˆï¼‰
"""
import sys
import os
import logging
import socket  # æ·»åŠ socketå¯¼å…¥
import smtplib
import random
import string
import time
from email.mime.text import MIMEText
from email.utils import formataddr

# é…ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')

def test_send_email():
    """æµ‹è¯•å‘é€é‚®ä»¶"""
    
    # é…ç½®
    QQ_MAIL_USER = "2361542526@qq.com"
    QQ_MAIL_AUTH_CODE = "jpzeajbnlmhyechd"  # è¯·ç¡®è®¤è¿™ä¸ªæˆæƒç æ˜¯å¦æ­£ç¡®
    SMTP_SERVER = "smtp.qq.com"
    
    # ç”ŸæˆéªŒè¯ç 
    code = ''.join(random.choices(string.digits, k=6))
    print(f"ç”Ÿæˆçš„éªŒè¯ç ï¼š{code}")
    
    # æµ‹è¯•é‚®ç®±
    to_email = input("è¯·è¾“å…¥ä½ çš„æµ‹è¯•é‚®ç®±ï¼š").strip()
    
    if not to_email:
        print("é‚®ç®±ä¸èƒ½ä¸ºç©º")
        return
    
    # é‚®ä»¶å†…å®¹
    content = f"""
æ‚¨çš„éªŒè¯ç æ˜¯ï¼š{code}

éªŒè¯ç æœ‰æ•ˆæœŸä¸º5åˆ†é’Ÿï¼Œè¯·å‹¿æ³„éœ²ç»™ä»–äººã€‚
    """
    
    # å°è¯•å¤šç§ç«¯å£å’Œè¿æ¥æ–¹å¼
    connection_methods = [
        {"port": 587, "use_tls": True, "name": "TLS"},
        {"port": 465, "use_ssl": True, "name": "SSL"},
        {"port": 25, "use_tls": False, "name": "æ™®é€šè¿æ¥"}
    ]
    
    for method in connection_methods:
        try:
            print(f"\nå°è¯•ä½¿ç”¨{method['name']}æ–¹å¼è¿æ¥ (ç«¯å£:{method['port']})...")
            
            # åˆ›å»ºé‚®ä»¶
            msg = MIMEText(content, "plain", "utf-8")
            msg["From"] = formataddr(("ä¸ªäººåšå®¢", QQ_MAIL_USER))
            msg["To"] = to_email
            msg["Subject"] = "ä¸ªäººåšå®¢éªŒè¯ç "
            
            # æ ¹æ®æ–¹å¼é€‰æ‹©è¿æ¥
            if method.get("use_ssl"):
                print(f"1. ä½¿ç”¨SSLè¿æ¥...")
                server = smtplib.SMTP_SSL(SMTP_SERVER, method["port"], timeout=30)
            else:
                print(f"1. ä½¿ç”¨æ™®é€šè¿æ¥...")
                server = smtplib.SMTP(SMTP_SERVER, method["port"], timeout=30)
                if method.get("use_tls"):
                    print("2. å¯åŠ¨TLSåŠ å¯†...")
                    server.starttls()
            
            # è®¾ç½®è°ƒè¯•çº§åˆ«ï¼ˆå¯çœ‹åˆ°è¯¦ç»†é€šä¿¡è¿‡ç¨‹ï¼‰
            server.set_debuglevel(1)
            
            print("3. ç™»å½•é‚®ç®±...")
            server.login(QQ_MAIL_USER, QQ_MAIL_AUTH_CODE)
            
            print(f"4. å‘é€é‚®ä»¶åˆ° {to_email}...")
            server.sendmail(QQ_MAIL_USER, [to_email], msg.as_string())
            
            print("5. å…³é—­è¿æ¥...")
            server.quit()
            
            print(f"\nâœ… ä½¿ç”¨{method['name']}æ–¹å¼å‘é€æˆåŠŸï¼éªŒè¯ç ï¼š{code}")
            print("è¯·æ£€æŸ¥ä½ çš„é‚®ç®±ï¼ˆåŒ…æ‹¬åƒåœ¾é‚®ä»¶ç®±ï¼‰")
            return True
            
        except smtplib.SMTPAuthenticationError as e:
            print(f"âŒ è®¤è¯å¤±è´¥ï¼š{e}")
            print("å»ºè®®ï¼šé‡æ–°è·å–QQé‚®ç®±æˆæƒç ")
            break  # è®¤è¯å¤±è´¥å°±ä¸å†å°è¯•å…¶ä»–æ–¹å¼
            
        except smtplib.SMTPServerDisconnected as e:
            print(f"âŒ æœåŠ¡å™¨æ–­å¼€è¿æ¥ï¼š{e}")
            print(f"   {method['name']}æ–¹å¼å¤±è´¥ï¼Œå°è¯•å…¶ä»–æ–¹å¼...")
            continue
            
        except socket.timeout as e:
            print(f"âŒ è¿æ¥è¶…æ—¶ï¼š{e}")
            continue
            
        except ConnectionRefusedError as e:
            print(f"âŒ è¿æ¥è¢«æ‹’ç»ï¼š{e}")
            continue
            
        except Exception as e:
            print(f"âŒ æœªçŸ¥é”™è¯¯ï¼š{type(e).__name__}: {e}")
            continue
    
    print("\nâŒ æ‰€æœ‰è¿æ¥æ–¹å¼éƒ½å¤±è´¥äº†")
    print("\nå¯èƒ½çš„åŸå› ï¼š")
    print("1. ç½‘ç»œé—®é¢˜ - æ£€æŸ¥æ˜¯å¦èƒ½è®¿é—®å¤–ç½‘")
    print("2. é˜²ç«å¢™é˜»æ­¢ - å°è¯•å…³é—­é˜²ç«å¢™/æ€æ¯’è½¯ä»¶")
    print("3. æˆæƒç é”™è¯¯ - è¯·é‡æ–°è·å–QQé‚®ç®±æˆæƒç ")
    print("4. QQé‚®ç®±å®‰å…¨é™åˆ¶ - ç™»å½•QQé‚®ç®±ç½‘é¡µç‰ˆï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å®‰å…¨æé†’")
    
    # æä¾›æˆæƒç è·å–æ­¥éª¤
    print("\nğŸ“§ é‡æ–°è·å–æˆæƒç æ­¥éª¤ï¼š")
    print("1. ç™»å½•QQé‚®ç®±ç½‘é¡µç‰ˆ (https://mail.qq.com)")
    print("2. ç‚¹å‡»ã€è®¾ç½®ã€‘â†’ã€è´¦æˆ·ã€‘")
    print("3. å‘ä¸‹æ‰¾åˆ°ã€POP3/IMAP/SMTPæœåŠ¡ã€‘")
    print("4. ç‚¹å‡»ã€ç”Ÿæˆæˆæƒç ã€‘")
    print("5. æŒ‰ç…§æç¤ºå‘é€çŸ­ä¿¡")
    print("6. å¤åˆ¶æ–°çš„16ä½æˆæƒç ")

if __name__ == "__main__":
    test_send_email()
```

---

## File: src\visit_counter.py

```py
# -*- coding: utf-8 -*-
"""
è®¿é—®è®¡æ•°æ¨¡å—ï¼ˆå¼‚æ­¥ä¿å­˜ + é˜²é‡å¤è®¡æ•°ï¼‰
"""
import json
import os
import time
import threading
from datetime import datetime

class VisitCounter:
    def __init__(self, save_file: str):
        self.save_file = save_file
        self.count = 0
        self.lock = threading.Lock()
        self.save_interval = 30  # 30ç§’è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
        self.last_save_time = time.time()
        self._load_count()
        # å¯åŠ¨å¼‚æ­¥ä¿å­˜çº¿ç¨‹
        self._start_async_save()

    def _load_count(self):
        """ä»æ–‡ä»¶åŠ è½½è®¡æ•°"""
        try:
            if os.path.exists(self.save_file):
                with open(self.save_file, "r", encoding="utf-8") as f:
                    data = json.load(f)
                    self.count = data.get("total_visits", 0)
        except Exception as e:
            print(f"åŠ è½½è®¿é—®è®¡æ•°å¤±è´¥ï¼š{e}")
            self.count = 0

    def _save_count(self, force: bool = False):
        """ä¿å­˜è®¡æ•°åˆ°æ–‡ä»¶ï¼ˆåŠ é”ï¼‰"""
        with self.lock:
            now = time.time()
            if not force and (now - self.last_save_time) < self.save_interval:
                return
            try:
                dir_name = os.path.dirname(self.save_file)
                if not os.path.exists(dir_name):
                    os.makedirs(dir_name)
                with open(self.save_file, "w", encoding="utf-8") as f:
                    json.dump({
                        "total_visits": self.count,
                        "update_time": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                    }, f, ensure_ascii=False, indent=4)
                self.last_save_time = now
            except Exception as e:
                print(f"ä¿å­˜è®¿é—®è®¡æ•°å¤±è´¥ï¼š{e}")

    def _async_save_count(self, force: bool = False):
        """å¼‚æ­¥ä¿å­˜ï¼ˆé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼‰"""
        threading.Thread(target=self._save_count, args=(force,), daemon=True).start()

    def _start_async_save(self):
        """å¯åŠ¨å®šæ—¶ä¿å­˜çº¿ç¨‹"""
        def auto_save():
            while True:
                time.sleep(self.save_interval)
                self._async_save_count()
        threading.Thread(target=auto_save, daemon=True).start()

    def count_visit(self) -> int:
        """è®¡æ•°+1å¹¶è¿”å›æœ€æ–°å€¼"""
        with self.lock:
            self.count += 1
            # è§¦å‘å¼‚æ­¥ä¿å­˜ï¼ˆéå¼ºåˆ¶ï¼‰
            self._async_save_count()
            return self.count

    def get_total_visits(self) -> int:
        """è·å–å½“å‰æ€»è®¿é—®é‡"""
        with self.lock:
            return self.count

    def reset_visits(self):
        """é‡ç½®è®¡æ•°ä¸º0"""
        with self.lock:
            self.count = 0
            self._async_save_count(force=True)

# å…¨å±€è®¡æ•°å™¨å®ä¾‹
global_counter = None

def init_visit_counter(save_file: str):
    """åˆå§‹åŒ–å…¨å±€è®¡æ•°å™¨"""
    global global_counter
    if global_counter is None:
        global_counter = VisitCounter(save_file)

def count_visit() -> int:
    """è®¡æ•°+1ï¼ˆå…¨å±€è°ƒç”¨ï¼‰"""
    if global_counter:
        return global_counter.count_visit()
    return 0

def get_total_visits() -> int:
    """è·å–æ€»è®¿é—®é‡ï¼ˆå…¨å±€è°ƒç”¨ï¼‰"""
    if global_counter:
        return global_counter.get_total_visits()
    return 0

def reset_visits():
    """é‡ç½®è®¡æ•°ï¼ˆå…¨å±€è°ƒç”¨ï¼‰"""
    if global_counter:
        global_counter.reset_visits()
```

---

## File: static\js\auth-interceptor.js

```js
// static/js/auth-interceptor.js
// ç™»å½•çŠ¶æ€æ‹¦æˆªå™¨ï¼Œè‡ªåŠ¨å¤„ç†401æœªæˆæƒ

(function() {
    // ä¿å­˜åŸå§‹çš„fetch
    const originalFetch = window.fetch;
    
    // éœ€è¦æ‹¦æˆªçš„APIè·¯å¾„
    const PROTECTED_PATHS = [
        '/api/talk/add',
        '/api/talk/delete',
        '/api/logout'
    ];
    
    // é‡å†™fetch
    window.fetch = async function(url, options = {}) {
        // æ£€æŸ¥æ˜¯å¦æ˜¯å—ä¿æŠ¤çš„API
        const isProtected = PROTECTED_PATHS.some(path => url.includes(path));
        
        // æ·»åŠ è®¤è¯å¤´
        if (isProtected) {
            const sessionId = Auth.getLocalSessionId();
            if (sessionId) {
                options.headers = {
                    ...options.headers,
                    'Authorization': `Session ${sessionId}`
                };
            }
            options.credentials = 'include';
        }
        
        try {
            const response = await originalFetch(url, options);
            
            // å¤„ç†401æœªæˆæƒ
            if (response.status === 401) {
                const data = await response.clone().json().catch(() => ({}));
                if (data.need_login || data.code === 401) {
                    Auth.clearLoginInfo();
                    
                    // ä¿å­˜å½“å‰é¡µé¢ï¼Œç™»å½•åè·³å›
                    const currentPath = window.location.pathname;
                    if (!currentPath.includes('/login/')) {
                        window.location.href = `/login/index.html?redirect=${encodeURIComponent(currentPath)}`;
                    }
                }
                return response;
            }
            
            return response;
        } catch (error) {
            console.error('è¯·æ±‚å¤±è´¥:', error);
            throw error;
        }
    };
    
    // æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†
    window.addEventListener('unhandledrejection', function(event) {
        console.error('æœªå¤„ç†çš„Promiseé”™è¯¯:', event.reason);
    });
})();
```

---

## File: static\js\auth.js

```js
// static/js/auth.js
// ç»Ÿä¸€çš„ç™»å½•çŠ¶æ€ç®¡ç†

const Auth = {
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    async checkLoginStatus() {
        try {
            console.log('æ­£åœ¨æ£€æŸ¥ç™»å½•çŠ¶æ€...');
            
            // ä»localStorageè·å–session_id
            const sessionId = this.getLocalSessionId();
            
            const res = await fetch('/api/check-login', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': sessionId ? `Session ${sessionId}` : ''
                },
                credentials: 'include'
            });
            
            if (!res.ok) {
                console.error('ç™»å½•çŠ¶æ€æ£€æŸ¥å¤±è´¥:', res.status);
                // å¦‚æœAPIå¤±è´¥ï¼Œå°è¯•ä»localStorageæ¢å¤
                const localUser = this.getLocalUser();
                if (localUser) {
                    return { isLogin: true, user: localUser };
                }
                return { isLogin: false, user: {} };
            }
            
            const data = await res.json();
            console.log('ç™»å½•çŠ¶æ€å“åº”:', data);
            
            // å¦‚æœæœåŠ¡å™¨è¿”å›æœªç™»å½•ï¼Œä½†localStorageæœ‰æ•°æ®ï¼Œä»ç„¶ä½¿ç”¨localStorage
            if (!data.isLogin) {
                const localUser = this.getLocalUser();
                if (localUser) {
                    console.log('ä½¿ç”¨localStorageçš„ç”¨æˆ·ä¿¡æ¯:', localUser);
                    return { isLogin: true, user: localUser };
                }
            }
            
            return {
                isLogin: data.isLogin || false,
                user: data.user || {}
            };
        } catch (error) {
            console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
            // å‡ºé”™æ—¶å°è¯•ä»localStorageæ¢å¤
            const localUser = this.getLocalUser();
            if (localUser) {
                return { isLogin: true, user: localUser };
            }
            return { isLogin: false, user: {} };
        }
    },

    // ç™»å‡º
    async logout() {
        try {
            // ä»localStorageè·å–session_id
            const sessionId = this.getLocalSessionId();
            
            const res = await fetch('/api/logout', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': sessionId ? `Session ${sessionId}` : ''
                },
                credentials: 'include'
            });
            
            const data = await res.json();
            console.log('ç™»å‡ºå“åº”:', data);
            
            this.clearLoginInfo();
            return { success: true, message: data.msg || 'é€€å‡ºæˆåŠŸ' };
        } catch (error) {
            console.error('ç™»å‡ºå¤±è´¥:', error);
            this.clearLoginInfo();
            return { success: true, message: 'å·²æ¸…é™¤æœ¬åœ°ç™»å½•çŠ¶æ€' };
        }
    },

    // ä¿å­˜ç™»å½•ä¿¡æ¯åˆ°localStorage
    saveLoginInfo(sessionId, userInfo) {
        if (sessionId) {
            localStorage.setItem('session_id', sessionId);
            console.log('ä¿å­˜session_idåˆ°localStorage:', sessionId);
        }
        if (userInfo) {
            localStorage.setItem('user_info', JSON.stringify(userInfo));
            console.log('ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°localStorage:', userInfo);
        }
    },

    // æ¸…é™¤ç™»å½•ä¿¡æ¯
    clearLoginInfo() {
        localStorage.removeItem('session_id');
        localStorage.removeItem('user_info');
        console.log('å·²æ¸…é™¤æœ¬åœ°å­˜å‚¨');
    },

    // è·å–æœ¬åœ°ç”¨æˆ·ä¿¡æ¯
    getLocalUser() {
        try {
            const userStr = localStorage.getItem('user_info');
            return userStr ? JSON.parse(userStr) : null;
        } catch {
            return null;
        }
    },

    // è·å–æœ¬åœ°sessionId
    getLocalSessionId() {
        return localStorage.getItem('session_id');
    }
};
```

---

## File: talk\comment.html

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç•™è¨€æ¿ | hyperçš„ä¸ªäººVlog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6a5acd;
            --primary-light: #8a7adc;
            --primary-dark: #4a3a9a;
            --accent: #ff6b6b;
            --accent-light: #ff8a8a;
            --accent-dark: #e04a4a;
            --light: #f8f9fa;
            --dark: #2d3436;
            --gray: #495057;
            --light-gray: #e9ecef;
            --white: #ffffff;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
            --shadow-md: 0 5px 15px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.12);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            color: var(--gray);
            line-height: 1.6;
            padding: 30px 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* å¤´éƒ¨å¯¼èˆª */
        .header-bar {
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: 15px 25px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            transform: rotate(10deg);
            transition: var(--transition);
        }

        .logo-icon:hover {
            transform: rotate(0deg) scale(1.1);
        }

        .logo-text {
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ç”¨æˆ·çŠ¶æ€ */
        .user-status {
            position: relative;
        }

        .user-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .user-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            min-width: 150px;
            display: none;
            z-index: 1000;
            margin-top: 10px;
            overflow: hidden;
            border: 1px solid var(--light-gray);
        }

        .dropdown-menu.show {
            display: block;
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            color: var(--gray);
            text-decoration: none;
            transition: var(--transition);
            border-bottom: 1px solid var(--light-gray);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--light);
            color: var(--primary);
            padding-left: 25px;
        }

        /* é¢åŒ…å±‘ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
            font-size: 0.95rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: white;
            border-radius: 20px;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .breadcrumb a:hover {
            background: var(--primary);
            color: white;
            transform: translateX(-3px);
        }

        .breadcrumb span {
            color: var(--gray);
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title h1 {
            font-size: 2.5rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .page-title h1 i {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.8rem;
        }

        .title-decoration {
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            margin: 15px auto 0;
            border-radius: 2px;
        }

        /* æ“ä½œæŒ‰é’®ç»„ */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .action-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
        }

        .action-btn.primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .action-btn.secondary {
            background: white;
            color: var(--primary);
            border: 1px solid var(--light-gray);
        }

        .action-btn.secondary:hover {
            background: var(--light);
            color: var(--accent);
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        /* ç•™è¨€æ¿ä¸»å®¹å™¨ */
        .message-board {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 35px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
        }

        /* ç•™è¨€è¾“å…¥åŒºåŸŸ */
        .message-input {
            margin-bottom: 45px;
            padding-bottom: 30px;
            border-bottom: 2px dashed var(--light-gray);
        }

        .input-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .input-header i {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .input-header h3 {
            font-size: 1.4rem;
            color: var(--dark);
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .input-group label i {
            color: var(--accent);
            margin-right: 5px;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--light);
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(106, 90, 205, 0.1);
        }

        .input-group input:read-only {
            background: linear-gradient(135deg, #f0f2f5, #e9ecef);
            cursor: not-allowed;
            border-color: #ddd;
            color: var(--primary);
            font-weight: 500;
        }

        .input-group textarea {
            min-height: 140px;
            resize: vertical;
            line-height: 1.6;
        }

        /* æäº¤æŒ‰é’® */
        .submit-btn {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            padding: 14px 35px;
            border-radius: 40px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .submit-btn:disabled {
            background: linear-gradient(135deg, #b0b0b0, #909090);
            cursor: not-allowed;
            transform: none;
            box-shadow: var(--shadow-sm);
        }

        .submit-btn:disabled::before {
            display: none;
        }

        .submit-btn i {
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .submit-btn:hover i {
            transform: translateX(5px);
        }

        /* ç™»å½•æç¤º */
        .login-tip {
            background: linear-gradient(135deg, #fff3cd, #ffe69b);
            color: #856404;
            padding: 15px 20px;
            border-radius: var(--radius-md);
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1rem;
            border-left: 4px solid var(--accent);
        }

        .login-tip i {
            font-size: 1.5rem;
            color: var(--accent);
        }

        .login-tip a {
            color: var(--primary-dark);
            font-weight: 600;
            text-decoration: none;
            margin-left: 5px;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }

        .login-tip a:hover {
            border-bottom-color: var(--primary);
        }

        /* ç•™è¨€åˆ—è¡¨ */
        .message-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message-item {
            background: var(--light);
            border-radius: var(--radius-md);
            padding: 25px;
            transition: var(--transition);
            border-left: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .message-item:hover {
            transform: translateX(8px) translateY(-3px);
            box-shadow: var(--shadow-lg);
            background: white;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .message-author {
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .author-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .message-time {
            font-size: 0.9rem;
            color: #888;
            background: white;
            padding: 5px 12px;
            border-radius: 20px;
            box-shadow: var(--shadow-sm);
        }

        .message-time i {
            margin-right: 5px;
            color: var(--accent);
        }

        .message-content {
            padding: 15px 0 10px 50px;
            line-height: 1.8;
            color: var(--gray);
            font-size: 1.05rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 30px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: var(--radius-lg);
            color: #888;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .empty-state p {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .empty-state .start-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            text-decoration: none;
            border-radius: 30px;
            font-weight: 500;
            transition: var(--transition);
        }

        .empty-state .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        /* é¡µè„š */
        .footer {
            text-align: center;
            padding: 30px 0;
            color: #888;
            font-size: 0.95rem;
        }

        .footer i {
            color: var(--accent);
            margin: 0 3px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--light-gray);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .header-bar {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .page-title h1 {
                font-size: 2rem;
            }

            .message-board {
                padding: 20px;
            }

            .message-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .message-content {
                padding-left: 0;
            }

            .action-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <div class="header-bar">
            <div class="logo-area">
                <div class="logo-icon">
                    <i class="fas fa-comment-dots"></i>
                </div>
                <span class="logo-text">hyperçš„ç•™è¨€æ¿</span>
            </div>

            <!-- ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º -->
            <div class="user-status">
                <div class="user-dropdown">
                    <button class="user-btn" id="userBtn">
                        <i class="fas fa-user-circle"></i>
                        <span id="usernameDisplay">æœªç™»å½•</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <a href="/login/index.html" class="dropdown-item" id="loginItem">
                            <i class="fas fa-sign-in-alt"></i> ç™»å½•
                        </a>
                        <a href="/login/register.html" class="dropdown-item" id="registerItem">
                            <i class="fas fa-user-plus"></i> æ³¨å†Œ
                        </a>
                        <a href="javascript:void(0)" class="dropdown-item" id="logoutItem" onclick="handleLogout()" style="display: none;">
                            <i class="fas fa-sign-out-alt"></i> é€€å‡º
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¢åŒ…å±‘ -->
        <div class="breadcrumb">
            <a href="/home/index.html"><i class="fas fa-home"></i> é¦–é¡µ</a>
            <span><i class="fas fa-chevron-right"></i></span>
            <span>ç•™è¨€æ¿</span>
        </div>

        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-title">
            <h1>
                <i class="fas fa-comments"></i>
                ç•™è¨€æ¿
            </h1>
            <div class="title-decoration"></div>
        </div>

        <!-- æ“ä½œæŒ‰é’®ç»„ -->
        <div class="action-buttons">
            <a href="/home/index.html" class="action-btn secondary">
                <i class="fas fa-arrow-left"></i> è¿”å›é¦–é¡µ
            </a>
            <a href="/login/index.html" class="action-btn primary" id="loginBtn" style="display: inline-flex;">
                <i class="fas fa-sign-in-alt"></i> å»ç™»å½•
            </a>
            <a href="javascript:void(0)" class="action-btn secondary" id="logoutBtn" onclick="handleLogout()" style="display: none;">
                <i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•
            </a>
        </div>

        <!-- ç•™è¨€æ¿ä¸»å®¹å™¨ -->
        <div class="message-board">
            <!-- ç•™è¨€è¾“å…¥åŒºåŸŸ -->
            <div class="message-input">
                <div class="input-header">
                    <i class="fas fa-pen-fancy"></i>
                    <h3>å†™ä¸‹ä½ çš„ç•™è¨€</h3>
                </div>
                <form id="messageForm">
                    <div class="input-group">
                        <label><i class="fas fa-user"></i> ä½ çš„æ˜µç§°</label>
                        <input type="text" id="username" placeholder="ç™»å½•åè‡ªåŠ¨å¡«å……" readonly>
                    </div>
                    <div class="input-group">
                        <label><i class="fas fa-comment"></i> ç•™è¨€å†…å®¹</label>
                        <textarea id="messageContent" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•ã€å»ºè®®æˆ–æ„Ÿå—..." required></textarea>
                    </div>
                    <button type="submit" class="submit-btn" id="submitBtn" disabled>
                        <span>æäº¤ç•™è¨€</span>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <div class="login-tip" id="loginTip" style="display: none;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>è¯·å…ˆ<a href="/login/index.html">ç™»å½•</a>åå†ç•™è¨€ï¼Œç™»å½•åè‡ªåŠ¨å¡«å……æ˜µç§°</span>
                    </div>
                </form>
            </div>

            <!-- ç•™è¨€åˆ—è¡¨åŒºåŸŸ -->
            <div class="message-list" id="messageList">
                <div class="empty-state">
                    <i class="fas fa-comment-dots"></i>
                    <p>åŠ è½½ç•™è¨€ä¸­...</p>
                    <div class="loading"></div>
                </div>
            </div>
        </div>

        <!-- é¡µè„š -->
        <div class="footer">
            <p><i class="fas fa-heart"></i> hyperçš„ä¸ªäººVlog <i class="fas fa-heart"></i></p>
        </div>
    </div>

    <script src="/static/js/auth.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let isLogin = false;
        let currentUser = {};

        // åˆå§‹åŒ–ç™»å½•çŠ¶æ€
        async function initLoginStatus() {
            try {
                console.log('ç•™è¨€æ¿ - æ­£åœ¨æ£€æŸ¥ç™»å½•çŠ¶æ€...');
                
                // å…ˆå°è¯•ä»localStorageè·å–
                const localUser = Auth.getLocalUser();
                if (localUser) {
                    console.log('ç•™è¨€æ¿ - ä»localStorageæ¢å¤ç”¨æˆ·ä¿¡æ¯:', localUser);
                    isLogin = true;
                    currentUser = localUser;
                } else {
                    const status = await Auth.checkLoginStatus();
                    console.log('ç•™è¨€æ¿ - ç™»å½•çŠ¶æ€:', status);
                    isLogin = status.isLogin;
                    currentUser = status.user;
                }
                
                // æ›´æ–°UI
                updateUI();
            } catch (error) {
                console.error('ç•™è¨€æ¿ - åˆå§‹åŒ–ç™»å½•çŠ¶æ€å¤±è´¥:', error);
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            const usernameInput = document.getElementById('username');
            const submitBtn = document.getElementById('submitBtn');
            const loginTip = document.getElementById('loginTip');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const userBtnText = document.getElementById('usernameDisplay');
            const loginItem = document.getElementById('loginItem');
            const registerItem = document.getElementById('registerItem');
            const logoutItem = document.getElementById('logoutItem');

            if (isLogin) {
                console.log('ç•™è¨€æ¿ - ç”¨æˆ·å·²ç™»å½•:', currentUser);
                if (usernameInput) usernameInput.value = currentUser.username || 'åŒ¿åç”¨æˆ·';
                if (submitBtn) submitBtn.disabled = false;
                if (loginTip) loginTip.style.display = 'none';
                if (loginBtn) loginBtn.style.display = 'none';
                if (logoutBtn) logoutBtn.style.display = 'inline-flex';
                if (userBtnText) userBtnText.textContent = currentUser.username || 'ç”¨æˆ·';
                if (loginItem) loginItem.style.display = 'none';
                if (registerItem) registerItem.style.display = 'none';
                if (logoutItem) logoutItem.style.display = 'flex';
            } else {
                console.log('ç•™è¨€æ¿ - ç”¨æˆ·æœªç™»å½•');
                if (usernameInput) usernameInput.value = '';
                if (submitBtn) submitBtn.disabled = true;
                if (loginTip) loginTip.style.display = 'flex';
                if (loginBtn) loginBtn.style.display = 'inline-flex';
                if (logoutBtn) logoutBtn.style.display = 'none';
                if (userBtnText) userBtnText.textContent = 'æœªç™»å½•';
                if (loginItem) loginItem.style.display = 'flex';
                if (registerItem) registerItem.style.display = 'flex';
                if (logoutItem) logoutItem.style.display = 'none';
            }
        }

        // å¤„ç†ç™»å‡º
        window.handleLogout = async function() {
            const result = await Auth.logout();
            if (result.success) {
                alert('é€€å‡ºç™»å½•æˆåŠŸï¼');
                isLogin = false;
                currentUser = {};
                updateUI();
                window.location.reload();
            } else {
                alert(result.message || 'é€€å‡ºå¤±è´¥');
            }
        };

        // åŠ è½½ç•™è¨€åˆ—è¡¨
        async function loadMessages() {
            try {
                const res = await fetch('/api/talk/list');
                const data = await res.json();
                
                if (data.code === 200) {
                    const list = data.data;
                    const messageList = document.getElementById('messageList');
                    
                    if (list && list.length > 0) {
                        const html = list.map(msg => `
                            <div class="message-item">
                                <div class="message-header">
                                    <div class="message-author">
                                        <div class="author-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        ${msg.username || 'åŒ¿åç”¨æˆ·'}
                                    </div>
                                    <div class="message-time">
                                        <i class="far fa-clock"></i>
                                        ${msg.create_time_str || ''}
                                    </div>
                                </div>
                                <div class="message-content">
                                    ${msg.content}
                                </div>
                            </div>
                        `).join('');
                        messageList.innerHTML = html;
                    } else {
                        messageList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-comment-dots"></i>
                                <p>æš‚æ— ç•™è¨€ï¼Œå¿«æ¥æˆä¸ºç¬¬ä¸€ä¸ªç•™è¨€çš„äººå§ï¼</p>
                                <a href="#messageForm" class="start-btn" onclick="document.getElementById('messageContent').focus()">
                                    <i class="fas fa-pen"></i> å†™ç•™è¨€
                                </a>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('åŠ è½½ç•™è¨€å¤±è´¥:', error);
                document.getElementById('messageList').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle" style="color: #dc3545;"></i>
                        <p style="color: #dc3545;">åŠ è½½ç•™è¨€å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</p>
                    </div>
                `;
            }
        }

        // æäº¤ç•™è¨€
        document.getElementById('messageForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!isLogin) {
                alert('è¯·å…ˆç™»å½•åå†ç•™è¨€ï¼');
                window.location.href = '/login/index.html?redirect=/talk';
                return;
            }

            const content = document.getElementById('messageContent').value.trim();

            if (!content) {
                alert('ç•™è¨€å†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span>æäº¤ä¸­...</span> <i class="fas fa-spinner fa-spin"></i>';
            submitBtn.disabled = true;

            try {
                // ä»localStorageè·å–session_id
                const sessionId = Auth.getLocalSessionId();
                console.log('æäº¤ç•™è¨€ - sessionId:', sessionId);
                
                const res = await fetch('/api/talk/add', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': sessionId ? `Session ${sessionId}` : ''
                    },
                    credentials: 'include',
                    body: JSON.stringify({ content })
                });
                
                const data = await res.json();
                console.log('æäº¤ç•™è¨€å“åº”:', data);
                
                if (data.code === 200) {
                    alert('ç•™è¨€æˆåŠŸï¼');
                    document.getElementById('messageContent').value = '';
                    loadMessages(); // é‡æ–°åŠ è½½ç•™è¨€åˆ—è¡¨
                } else if (data.code === 401) {
                    alert('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
                    Auth.clearLoginInfo();
                    isLogin = false;
                    currentUser = {};
                    updateUI();
                    window.location.href = '/login/index.html?redirect=/talk';
                } else {
                    alert(data.msg || 'ç•™è¨€å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            } catch (err) {
                console.error('ç•™è¨€é”™è¯¯:', err);
                alert('ç½‘ç»œé”™è¯¯ï¼Œç•™è¨€å¤±è´¥ï¼');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // ä¸‹æ‹‰èœå•
        const userBtn = document.getElementById('userBtn');
        const dropdownMenu = document.getElementById('dropdownMenu');
        
        if (userBtn) {
            userBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdownMenu.classList.toggle('show');
            });
        }
        
        document.addEventListener('click', function() {
            if (dropdownMenu) {
                dropdownMenu.classList.remove('show');
            }
        });

        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', () => {
            initLoginStatus();
            loadMessages();
        });
    </script>
</body>
</html>
```

---

